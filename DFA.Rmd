---
title: "DFA"
author: "Megan J"
date: "July 6, 2020"
output: html_document
---

```{r setup, include=FALSE}
library(MARSS)
library(lubridate)
library(dplyr)
library(ggplot2)
library(modelr)
require(gridExtra)
```

Below, the cleaned data is imported and prepared for analysis by transposing, converting dates, and Z-scoring. At the bottom, 3 years had additional cleaning that was done later to adjust for correlated data. These three years have a 'c'at the end of the data set year.

```{r Import data}

#1. Read the data
#2. Summarize into by-day data for the backwater
#3. Change the date to date format
#4. Save the dates
#5. Transpose
#6. Set the column names as dates
#7. Z-score the data
#8. Save the discharge 

#-----2018 MC-------
MC.2018.raw<- read.csv("MC2018Day.csv") #1
MC.2018.raw$Date<- ymd(MC.2018.raw$Date) #3
MC.2018r<- as.matrix(MC.2018.raw[,c(2:6),]) 
date<- MC.2018.raw[,"Date"] #4
MC.2018.t<- t(MC.2018r) #5
colnames(MC.2018.t)<-date #6
MC.2018=(MC.2018.t-apply(MC.2018.t,1,mean,na.rm=TRUE))/ sqrt(apply(MC.2018.t,1,var,na.rm=TRUE)) #7
Discharge8 <- t(MC.2018.raw[,"Discharge",drop=FALSE]) #8


#-----2017 MC-------
MC.2017.raw<- read.csv("MC2017Day.csv") #1
MC.2017.raw$Date<- ymd(MC.2017.raw$Date) #3
MC.2017r<- as.matrix(MC.2017.raw[,c(2:6),])
date7<- MC.2017.raw[,"Date"] #4
MC.2017.t<- t(MC.2017r) #5
colnames(MC.2017.t)<-date7 #6
MC.2017=(MC.2017.t-apply(MC.2017.t,1,mean,na.rm=TRUE))/ sqrt(apply(MC.2017.t,1,var,na.rm=TRUE)) #7
Discharge7 <- t(MC.2017.raw[,"Discharge",drop=FALSE]) #8



#-----2016 MC-------
MC.2016.raw<- read.csv("MC2016Day.csv") #1
MC.2016.raw$Date<- ymd(MC.2016.raw$Date) #3
MC.2016r<- as.matrix(MC.2016.raw[,c(2:6),]) 
date6<- MC.2016.raw[,"Date"] #4
MC.2016.t<- t(MC.2016r) #5
colnames(MC.2016.t)<-date6 #6
MC.2016=(MC.2016.t-apply(MC.2016.t,1,mean,na.rm=TRUE))/ sqrt(apply(MC.2016.t,1,var,na.rm=TRUE)) #7
Discharge6 <- t(MC.2016.raw[,"Discharge",drop=FALSE]) #8



#-----2015 MC-------
MC.2015.raw<- read.csv("MC2015Day.csv") #1
MC.2015.raw$Date<- ymd(MC.2015.raw$Date) #3
MC.2015r<- as.matrix(MC.2015.raw[,c(2:6),]) 
date5<- MC.2015.raw[,"Date"] #4
MC.2015.t<- t(MC.2015r) #5
colnames(MC.2015.t)<-date5 #6
MC.2015=(MC.2015.t-apply(MC.2015.t,1,mean,na.rm=TRUE))/ sqrt(apply(MC.2015.t,1,var,na.rm=TRUE)) #7
Discharge5 <- t(MC.2015.raw[,"Discharge",drop=FALSE]) #8

#-----2018 SI-------
SI.2015.raw<- read.csv("SI2015B.csv") #1
SI.2015.raw<- SI.2015.raw %>% group_by(Date) %>% summarize(Turb= mean(Turb), CHLugL= mean(CHLugL), BGAugL= mean(BGAugL), 
                                                           FDOMqsu=mean(FDOMqsu), NO3_mgL=mean(NO3_mgL),
                                                           Discharge=mean(Discharge)) #2
SI.2015.raw$Date<- ymd(SI.2015.raw$Date) #3
SI.2015r<- as.matrix(SI.2015.raw[,c(2:6),])
dateS5<- ymd(SI.2015.raw$Date) #4
SI.2015.t<- t(SI.2015r) #5
colnames(SI.2015.t)<-dateS5 #6
SI.2015=(SI.2015.t-apply(SI.2015.t,1,mean,na.rm=TRUE))/ sqrt(apply(SI.2015.t,1,var,na.rm=TRUE)) #7
Discharge5s <- t(SI.2015.raw[,"Discharge",drop=FALSE]) #8



#-----2016 SI-------
SI.2016.raw<- read.csv("SI2016B.csv") #1
SI.2016.raw<- SI.2016.raw %>% group_by(Date) %>% summarize(Turb= mean(Turb), CHLugL= mean(CHLugL), BGAugL= mean(BGAugL), 
                                                           FDOMqsu=mean(FDOMqsu), NO3_mgL=mean(NO3_mgL),
                                                           Discharge=mean(Discharge)) #2
SI.2016.raw$Date<- ymd(SI.2016.raw$Date) #3
SI.2016r<- as.matrix(SI.2016.raw[,c(2:6),])
dateS6<- ymd(SI.2016.raw$Date) #4
SI.2016.t<- t(SI.2016r) #5
colnames(SI.2016.t)<-dateS6 #6
SI.2016=(SI.2016.t-apply(SI.2016.t,1,mean,na.rm=TRUE))/ sqrt(apply(SI.2016.t,1,var,na.rm=TRUE)) #7
Discharge6s <- t(SI.2016.raw[,"Discharge",drop=FALSE]) #8



#-----2015 SI-------
SI.2018.raw<- read.csv("SI2018B.csv") #1
SI.2018.raw<- SI.2018.raw %>% group_by(Date) %>% summarize(Turb= mean(Turb), CHLugL= mean(CHLugL), BGAugL= mean(BGAugL), 
                                                           FDOMqsu=mean(FDOMqsu), NO3_mgL=mean(NO3_mgL),
                                                           Discharge=mean(Discharge)) #2
SI.2018.raw$Date<- ymd(SI.2018.raw$Date) #3
SI.2018r<- as.matrix(SI.2018.raw[,c(2:6),])
dateS8<- ymd(SI.2018.raw$Date) #4
SI.2018.t<- t(SI.2018r) #5
colnames(SI.2018.t)<-dateS8 #6
SI.2018=(SI.2018.t-apply(SI.2018.t,1,mean,na.rm=TRUE))/ sqrt(apply(SI.2018.t,1,var,na.rm=TRUE)) #7
Discharge8s <- t(SI.2018.raw[,"Discharge",drop=FALSE]) #8



#--------CORRECTING FOR CORRELATED DATA--------------
SI.2015.rawc<- read.csv("2015SICalDay.csv") #1
SI.2015.rawc$Date<- ymd(SI.2015.rawc$Date) #3
SI.2015cr<- as.matrix(SI.2015.rawc[,c(2:6),])
dateSc5<- ymd(SI.2015.rawc$Date) #4
SI.2015.ct<- t(SI.2015cr) #5
colnames(SI.2015.ct)<-dateSc5 #6
SI.2015c=(SI.2015.ct-apply(SI.2015.ct,1,mean,na.rm=TRUE))/ sqrt(apply(SI.2015.ct,1,var,na.rm=TRUE)) #7
Discharge5cs <- t(SI.2015.rawc[,"Discharge",drop=FALSE]) #8

MC.2015.rawc<- read.csv("2015MCCalDay.csv") #1
MC.2015.rawc$Date<- ymd(MC.2015.rawc$Date) #3
MC.2015cr<- as.matrix(MC.2015.rawc[,c(2:6),])
datec5<- ymd(MC.2015.rawc$Date) #4
MC.2015.ct<- t(MC.2015cr) #5
colnames(MC.2015.ct)<-datec5 #6
MC.2015c=(MC.2015.ct-apply(MC.2015.ct,1,mean,na.rm=TRUE))/ sqrt(apply(MC.2015.ct,1,var,na.rm=TRUE)) #7
Discharge5c <- t(MC.2015.rawc[,"Discharge",drop=FALSE]) #8

SI.2018.rawc<- read.csv("2018SICalDay.csv") #1
SI.2018.rawc$Date<- ymd(SI.2018.rawc$Date) #3
SI.2018cr<- as.matrix(SI.2018.rawc[,c(2:6),])
dateSc8<- ymd(SI.2018.rawc$Date) #4
SI.2018.ct<- t(SI.2018cr) #5
colnames(SI.2018.ct)<-dateSc8 #6
SI.2018c=(SI.2018.ct-apply(SI.2018.ct,1,mean,na.rm=TRUE))/ sqrt(apply(SI.2018.ct,1,var,na.rm=TRUE)) #7
Discharge8cs <- t(SI.2018.rawc[,"Discharge",drop=FALSE]) #8
```

Below is a sample DFA to test the function and results.
```{r Sample DFA}
#Testing the DFA
N.ts = dim(MC.2018.t)[1] #Height
LL = dim(MC.2018.t)[2] #Length
m=1 
R.model = "diagonal and equal"
cntl.list = list(maxit=5000, allow.degen=FALSE )
dfa.model = list(A="zero", R=R.model, m=m)
MCtest1= MARSS(MC.2018.t, model=dfa.model, control=cntl.list, form="dfa", covariates= Discharge, z.score=TRUE)

```

Below are the DFA loops which run through trendlines 1 to 3 and check the 3 R models (diagonal and equal, diagonal andunequal, and equal covariance). For each year and location, no covariates and discharge as a covariate are run through separate loops. They are saved as "(MC/SI)201(#)(N)DFAobj.RData" where the SI/MC is the location, the # is the year, and the N is added if there are no covariates

```{r DFA Loops}

#Initially RUN WITHOUT Z-SCORED DATA !!!! (To adjust for Z-score, MC.2018.t needs to be MC.2018 (and SI.2018c/MC.2015c/SI.2018c for those that were adjusted for correlations)). Has been adjusted for thi in the code. Saved data has not changed

R.model = c("diagonal and equal", "diagonal and unequal", "equalvarcov") #R matrixes to run through
cntl.list = list(maxit=5000, allow.degen=FALSE )


#2018 MC No discharge
MC2018.modoutput.nocov = data.frame() #list to save model objects 
MC2018.modobj.nocov =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #Loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(MC.2018, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) #DFA run
      MC2018.modoutput.nocov = rbind(MC2018.modoutput.nocov , 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc, 
                                                Covariate = "NoCov", 
                                                stringsAsFactors=FALSE)) #Save the info
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  MC2018.modobj.nocov[[rr]] = modobj.m 
  names(MC2018.modobj.nocov)[rr]=R.model[rr] 
}


#2018 MC Discharge
MC2018.modoutput.dis = data.frame() #list to save model objects 
MC2018.modobj.dis =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(MC.2018, model=dfa.model, control=cntl.list, covariates=Discharge, form="dfa",  z.score=TRUE, fit=TRUE)
      MC2018.modoutput.dis = rbind(MC2018.modoutput.dis, 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc,
                                                Covariate= "Discharge",
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  MC2018.modobj.dis[[rr]] = modobj.m 
  names(MC2018.modobj.dis)[rr]=R.model[rr] 
  }#end rr loop


#2017 MC No Discharge

MC2017.modoutput.nocov = data.frame() #list to save model objects 
MC2017.modobj.nocov =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(MC.2017, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
      MC2017.modoutput.nocov = rbind(MC2017.modoutput.nocov , 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc, 
                                                Covariate = "NoCov", 
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  MC2017.modobj.nocov[[rr]] = modobj.m 
  names(MC2017.modobj.nocov)[rr]=R.model[rr] 
}

#MC 2017 Discharge

MC2017.modoutput.dis = data.frame() #list to save model objects 
MC2017.modobj.dis =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(MC.2017, model=dfa.model, control=cntl.list, covariates=Discharge7, form="dfa",  z.score=TRUE, fit=TRUE)
      MC2017.modoutput.dis = rbind(MC2017.modoutput.dis, 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc,
                                                Covariate= "Discharge",
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  MC2017.modobj.dis[[rr]] = modobj.m 
  names(MC2017.modobj.dis)[rr]=R.model[rr] 
  }#end rr loop

#2016 MC No Discharge

MC2016.modoutput.nocov = data.frame() #list to save model objects 
MC2016.modobj.nocov =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(MC.2016, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
      MC2016.modoutput.nocov = rbind(MC2016.modoutput.nocov , 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc, 
                                                Covariate = "NoCov", 
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  MC2016.modobj.nocov[[rr]] = modobj.m 
  names(MC2016.modobj.nocov)[rr]=R.model[rr] 
}

#MC 2016 Discharge

MC2016.modoutput.dis = data.frame() #list to save model objects 
MC2016.modobj.dis =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(MC.2016, model=dfa.model, control=cntl.list, covariates=Discharge6, form="dfa",  z.score=TRUE, fit=TRUE)
      MC2016.modoutput.dis = rbind(MC2016.modoutput.dis, 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc,
                                                Covariate= "Discharge",
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  MC2016.modobj.dis[[rr]] = modobj.m 
  names(MC2016.modobj.dis)[rr]=R.model[rr] 
  }#end rr loop

#2015 MC No discharge

MC2015.modoutput.nocov = data.frame() #list to save model objects 
MC2015.modobj.nocov =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(MC.2015c, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
      MC2015.modoutput.nocov = rbind(MC2015.modoutput.nocov , 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc, 
                                                Covariate = "NoCov", 
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  MC2015.modobj.nocov[[rr]] = modobj.m 
  names(MC2015.modobj.nocov)[rr]=R.model[rr] 
}

#MC 2015 Discharge

MC2015.modoutput.dis = data.frame() #list to save model objects 
MC2015.modobj.dis =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(MC.2015c, model=dfa.model, control=cntl.list, covariates=Discharge5, form="dfa",  z.score=TRUE, fit=TRUE)
      MC2015.modoutput.dis = rbind(MC2015.modoutput.dis, 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc,
                                                Covariate= "Discharge",
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  MC2015.modobj.dis[[rr]] = modobj.m 
  names(MC2015.modobj.dis)[rr]=R.model[rr] 
  }#end rr loop

#SAVE 'EM!- remember these are not Z-scored
saveRDS(MC2015.modobj.dis, file="MC2015DFAobj.RData")
saveRDS(MC2015.modobj.nocov, file="MC2015NDFAobj.RData")
saveRDS(MC2016.modobj.dis, file="MC2016DFAobj.RData")
saveRDS(MC2016.modobj.nocov, file="MC2016NDFAobj.RData")
saveRDS(MC2017.modobj.dis, file="MC2017DFAobj.RData")
saveRDS(MC2017.modobj.nocov, file="MC2017NDFAobj.RData")
saveRDS(MC2018.modobj.dis, file="MC2018DFAobj.RData")
saveRDS(MC2018.modobj.nocov, file="MC2018NDFAobj.RData")


#2018 SI No Discharge
SI2018.modoutput.nocov = data.frame() #list to save model objects 
SI2018.modobj.nocov =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) {  #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(SI.2018c, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
      SI2018.modoutput.nocov = rbind(SI2018.modoutput.nocov , 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc, 
                                                Covariate = "NoCov", 
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  SI2018.modobj.nocov[[rr]] = modobj.m 
  names(SI2018.modobj.nocov)[rr]=R.model[rr] 
}

#SI 2018 Discharge
SI2018.modoutput.dis = data.frame() #list to save model objects 
SI2018.modobj.dis =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(SI.2018c, model=dfa.model, control=cntl.list, covariates=Discharge8s, form="dfa",  z.score=TRUE, fit=TRUE)
      SI2018.modoutput.dis = rbind(SI2018.modoutput.dis, 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc,
                                                Covariate= "Discharge",
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  SI2018.modobj.dis[[rr]] = modobj.m 
  names(SI2018.modobj.dis)[rr]=R.model[rr] 
  }#end rr loop



#2016 SI No Discharge

SI2016.modoutput.nocov = data.frame() #list to save model objects 
SI2016.modobj.nocov =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(SI.2016, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
      SI2016.modoutput.nocov = rbind(SI2016.modoutput.nocov , 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc, 
                                                Covariate = "NoCov", 
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  SI2016.modobj.nocov[[rr]] = modobj.m 
  names(SI2016.modobj.nocov)[rr]=R.model[rr] 
}


#SI 2016 Discharge
SI2016.modoutput.dis = data.frame() #list to save model objects 
SI2016.modobj.dis =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(SI.2016, model=dfa.model, control=cntl.list, covariates=Discharge6s, form="dfa",  z.score=TRUE, fit=TRUE)
      SI2016.modoutput.dis = rbind(SI2016.modoutput.dis, 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc,
                                                Covariate= "Discharge",
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  SI2016.modobj.dis[[rr]] = modobj.m 
  names(SI2016.modobj.dis)[rr]=R.model[rr] 
  }#end rr loop

#2015 SI No Discharge

SI2015.modoutput.nocov = data.frame() #list to save model objects 
SI2015.modobj.nocov =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(SI.2015c, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
      SI2015.modoutput.nocov = rbind(SI2015.modoutput.nocov , 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc, 
                                                Covariate = "NoCov", 
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  SI2015.modobj.nocov[[rr]] = modobj.m 
  names(SI2015.modobj.nocov)[rr]=R.model[rr] 
}


#2015 SI Discharge
SI2015.modoutput.dis = data.frame() #list to save model objects 
SI2015.modobj.dis =list(c())
for(rr in 1:length(R.model)){ #loop over R structures 
  for(m in 1:3) { #loop over 1-3 trends
      modobj.m = list(c())
      dfa.model = list(A="zero", R=R.model[rr], m=m)
      kemz=MARSS(SI.2015c, model=dfa.model, control=cntl.list, covariates=Discharge5s, form="dfa",  z.score=TRUE, fit=TRUE)
      SI2015.modoutput.dis = rbind(SI2015.modoutput.dis, 
                                     data.frame(R=R.model[rr], 
                                                m=m, 
                                                logLik=kemz$logLik, 
                                                AICc=kemz$AICc,
                                                Covariate= "Discharge",
                                                stringsAsFactors=FALSE))
      assign(paste("kemz", m, R.model[rr], sep="."), kemz) 
      modobj.m[[m]]=kemz 
      names(modobj.m)[m]=paste("m",m, sep="")
      } # end m loop 
  SI2015.modobj.dis[[rr]] = modobj.m 
  names(SI2015.modobj.dis)[rr]=R.model[rr] 
  }#end rr loop

#SAVE 'EM
saveRDS(SI2015.modobj.dis, file="SI2015DFAobj.RData")
saveRDS(SI2015.modobj.nocov, file="SI2015NDFAobj.RData")
saveRDS(SI2016.modobj.dis, file="SI2016DFAobj.RData")
saveRDS(SI2016.modobj.nocov, file="SI2016NDFAobj.RData")
saveRDS(SI2018.modobj.dis, file="SI2018DFAobj.RData")
saveRDS(SI2018.modobj.nocov, file="SI2018NDFAobj.RData")

#readRDS: to open the above files later, don't need to run again
#qqy<-readRDS( file="SI2015DFAobj.RData")
```

Below, the outputs from the no discharge and discharge are combined and saved as (MC/SI)201(#)DFA.csv. Several sample plots and analyses are run.


```{r Save Tests and Sample Visualization}

#Combine the discharge and no discharge to compare AIC values
MC2018DFA<- rbind(MC2018.modoutput.dis, MC2018.modoutput.nocov)
MC2017DFA<- rbind(MC2017.modoutput.dis, MC2017.modoutput.nocov)
MC2016DFA<- rbind(MC2016.modoutput.dis, MC2016.modoutput.nocov)
MC2015DFA<- rbind(MC2015.modoutput.dis, MC2015.modoutput.nocov)
MC2018DFA<-MC2018DFA %>% arrange(AICc)
MC2017DFA<-MC2017DFA %>% arrange(AICc)
MC2016DFA<-MC2016DFA %>% arrange(AICc)
MC2015DFA<-MC2015DFA %>% arrange(AICc)

#Save the AIC values
write.csv(MC2018DFA, file= "MC2018DFA.csv")
write.csv(MC2017DFA, file= "MC2017DFA.csv")
write.csv(MC2016DFA, file= "MC2016DFA.csv")
write.csv(MC2015DFA, file= "MC2015DFA.csv")

#Combine the discharge and no discharge to compare AIC values
SI2018DFA<- rbind(SI2018.modoutput.dis, SI2018.modoutput.nocov)
SI2016DFA<- rbind(SI2016.modoutput.dis, SI2016.modoutput.nocov)
SI2015DFA<- rbind(SI2015.modoutput.dis, SI2015.modoutput.nocov)
SI2018DFA<-SI2018DFA %>% arrange(AICc)
SI2016DFA<-SI2016DFA %>% arrange(AICc)
SI2015DFA<-SI2015DFA %>% arrange(AICc)

#Save the AIC values
write.csv(SI2018DFA, file= "SI2018DFA.csv")
write.csv(SI2016DFA, file= "SI2016DFA.csv")
write.csv(SI2015DFA, file= "SI2015DFA.csv")

#SAMPLE: Pull the data
mod= MC2015.modobj.nocov$'diagonal and unequal'$m3
daMCtest1= mod$model$data

#SAMPLE: Rotation
Z.est = coef( mod, type="matrix")$Z # get the inverse of the rotation matrix 
H.inv = varimax(Z.est)$rotmat 
Z.rot = Z.est %*% H.inv # rotate factor loadings 
trends.rot = solve(H.inv) %*%  mod$states # rotate trends 

#SAMPLE: Get the Z matrix
MCtest1.unrotat=coef(mod, type="matrix")$Z 
rownames(MCtest1.unrotat)=rownames(daMCtest1) 
MCtest1.unrotat

#SAMPLE GRAPH
#Plot the Factor Loadings

spp = rownames(MC.2015) 
minZ = 0.00005 
m=dim(trends.rot)[1] 
ylims = c(-1.1*max(abs(Z.rot)), 1.1*max(abs(Z.rot))) 
#par(mfrow=c(ceiling(m/2),2), mar=c(3,4,1.5,0.5), oma=c(0.4,1,1,1)) 
for(i in 1:m) { 
  plot(c(1:5)[abs(Z.rot[,i])>minZ], as.vector(Z.rot[abs(Z.rot[,i])>minZ,i]), type="h", lwd=2, xlab="", ylab="", xaxt="n", ylim=ylims, xlim=c(0,6)) 
  for(j in 1:5) { 
    if(Z.rot[j,i] > minZ) {
      text(j, -0.05, spp[j], srt=90, adj=1, cex=0.9)
      } 
    if(Z.rot[j,i] < -minZ) {
      text(j, 0.05, spp[j], srt=90, adj=0, cex=0.9)
      } 
    abline(h=0, lwd=1, col="gray") 
    } # end j loop 
  mtext(paste("Factor loadings on trend",i,sep=" "),side=3,line=.5) 
  } # end i loop

#SAMPLE Plot the Trend Line

ylbl<- rownames(MC.2015)
w_ts <- seq(dim(MC.2015)[2])
N_ts <- dim(MC.2015)[1]
clr <- c("brown","blue","darkgreen","darkred","purple")
#layout(matrix(c(1, 2, 3, 4, 5, 6), 3, 2), widths = c(2, 1))
## par(mfcol=c(mm,2), mai=c(0.5,0.5,0.5,0.1), omi=c(0,0,0,0))
# par(mai = c(0.5, 0.5, 0.5, 0.1), omi = c(0, 0, 0, 0))
for (i in 1:5) { ## plot the processes
    ylm <- c(-1, 1) * max(abs(trends.rot[i, ]))
    plot(w_ts, trends.rot[i, ], type = "n", bty = "L", ylim = ylm, 
        xlab = "", ylab = "", xaxt = "n") ## set up plot area
    abline(h = 0, col = "gray") ## draw zero-line
    lines(w_ts, trends.rot[i, ], lwd = 2) ## plot trend line
    lines(w_ts, trends.rot[i, ], lwd = 2)
    mtext(paste("State", i), side = 3, line = 0.5) ## add panel labels
    #axis(1, 12 * (0:dim(MC.2015)[2]) + 1, yr_frst + 0:dim(MC.2015)[2])
}

#SAMPLE Get the Range 

get_DFA_fits <- function(MLEobj,dd=NULL,alpha=0.05) {
  fits <- list() ## empty list for results
  Ey <- MARSS:::MARSShatyt(MLEobj) ## extra stuff for var() calcs
	ZZ <- coef(MLEobj, type="matrix")$Z ## model params
	nn <- dim(Ey$ytT)[1] ## number of obs ts
	TT <- dim(Ey$ytT)[2] ## number of time steps
	H_inv <- varimax(ZZ)$rotmat ## get the inverse of the rotation matrix
	if(!is.null(dd)) {## check for covars
	  DD <- coef(MLEobj, type="matrix")$D ## model expectation
	  fits$ex <- ZZ %*% H_inv %*% MLEobj$states + DD %*% dd
	} else { ## model expectation
	  fits$ex <- ZZ %*% H_inv %*% MLEobj$states
	}
	VtT <- MARSSkfss(MLEobj)$VtT ## Var in model fits
	VV <- NULL
	for(tt in 1:TT) {
	  RZVZ <- coef(MLEobj, type="matrix")$R - ZZ%*%VtT[,,tt]%*%t(ZZ)
	  SS <- Ey$yxtT[,,tt] - Ey$ytT[,tt,drop=FALSE] %*% t(MLEobj$states[,tt,drop=FALSE])
	  VV <- cbind(VV,diag(RZVZ + SS%*%t(ZZ) + ZZ%*%t(SS)))
	  }
 	SE <- sqrt(VV)
 	fits$up <- qnorm(1-alpha/2)*SE + fits$ex ## upper & lower (1-alpha)% CI
 	fits$lo <- qnorm(alpha/2)*SE + fits$ex
 	return(fits)
}



## SAMPLE Get Model Fits & CI's

mod_fit <- get_DFA_fits(mod)


## SAMPLE Plot the Fits
#par(mfrow=c(N_ts,1), mai=c(0.5,0.7,0.1,0.1), omi=c(0,0,0,0))
for(i in 1:N_ts) {
  up <- mod_fit$up[i,]
  mn <- mod_fit$ex[i,]
  lo <- mod_fit$lo[i,]
  plot(w_ts,mn,xlab="",ylab=ylbl[i],xaxt="n",type="n", cex.lab=1.2,
       ylim=c(min(lo),max(up)))
  #axis(1,12*(0:dim(dat_1980)[2])+1,yr_frst+0:dim(dat_1980)[2])
  points(w_ts,MC.2015[i,], pch=16, col=clr[i])
  lines(w_ts, up, col="darkgray")
  lines(w_ts, mn, col="black", lwd=2)
  lines(w_ts, lo, col="darkgray")
}


#SAMPLE Assess model fit
#model predicted values for each time series 
par.mat=coef(mod, type="matrix") 
coastal.fit.b = par.mat$Z %*% mod$states + matrix(par.mat$A, nrow=N.ts, ncol=TT) + par.mat$D %*% t(as.matrix(mod$call$covariates))
 #Get residuals 
coastal.resids=c() 
coastal.resids.mat = matrix(NA,dim(dat)[1],dim(dat)[2] ) 
for(i in 1: nrow(dat)){ 
  coastal.resids= dat[i,]- coastal.fit.b[i,] 
  coastal.resids.mat[i,]=coastal.resids 
  } 
rownames(coastal.resids.mat)=rownames(dat) coastal.resids.mat[1:7,1:3]
  
#Covariate effect
# MCtest1.trends= mod$states 
# MCtest1.effect = coef(mod)$D 
# MCtest1.effect
# par.mat=coef(mod, type="matrix") 
# par.mat$D
# MCtest1.fit.b = par.mat$Z %*% mod$states + 
#   matrix(par.mat$A, nrow=5, ncol=122) + 
#   par.mat$D %*% (Discharge)
# MCtest1.resids=c() 
# MCtest1.resids.mat = matrix(NA,dim(daMCtest1)[1],dim(daMCtest1)[2] ) 
# for(i in 1: nrow(daMCtest1)){ 
#   MCtest1.resids= daMCtest1[i,]- MCtest1.fit.b[i,] 
#   MCtest1.resids.mat[i,]=MCtest1.resids 
#   } 
# rownames(MCtest1.resids.mat)=rownames(daMCtest1) 
# MCtest1.resids.mat



```



Below, the AICc values are combined into a dataset and graphed on a barplot

```{r Bar Graph for Best Analysis}
#Probably don't need

#A save the normalized AICc values
All_Data<- rbind((MC2015DFA %>% filter(m=='5')%>% mutate(Desc= c("MC2015"))%>% mutate(AICcNorm=AICc- min(AICc))), 
                 (MC2016DFA %>% filter(m=='5')%>% mutate(Desc= c("MC2016"))%>% mutate(AICcNorm= AICc- min(AICc))), 
                 (MC2017DFA %>% filter(m=='5')%>% mutate(Desc= c("MC2017"))%>% mutate(AICcNorm= AICc-min(AICc))), 
                 (MC2018DFA %>% filter(m=='5')%>% mutate(Desc= c("MC2018"))%>% mutate(AICcNorm= AICc- min(AICc))), 
                 (SI2015DFA %>% filter(m=='5')%>% mutate(Desc= c("SI2015"))%>% mutate(AICcNorm= AICc- min(AICc))), 
                 (SI2016DFA %>% filter(m=='5')%>% mutate(Desc= c("SI2016"))%>% mutate(AICcNorm= AICc- min(AICc))), 
                 (SI2018DFA %>% filter(m=='5')%>% mutate(Desc= c("SI2018"))%>% mutate(AICcNorm= AICc- min(AICc))))



#All_Data<- All_Data %>% mutate(Desc2= paste(Desc, R)) %>% select(!(c(AICc, logLik)))#filter(m=='3') %>% select(!(c(AICc, logLik))) 

#Save all of the AIC values
write.csv(All_Data, "AICAll.csv", row.names= FALSE)

#A bar graph to compare the AICc values for each year, all for the 5 trend line option
S8<- ggplot(data=(All_Data), mapping= aes(x=R, y=AICcNorm, fill= Covariate)) +
  geom_bar(stat="identity", position=position_dodge()) + 
  scale_x_discrete(limits=c("diagonal and unequal", "equalvarcov", "diagonal and equal"))  +
  labs(x= "R marix Type", y="AICc")+ 
  scale_fill_discrete(labels=c("Discharge", "None")) + 
  facet_wrap(~ Desc, ncol=4 ) +
  theme(axis.text.x = element_text(size= 7, angle = 90)) + 
  ggtitle("AIC Values for Main Channel and Backwater Data")


S8
```

Below, the inverze Z matrixes and loadings are found for the DFA runs with 4 trends and 3 trends each (3 is first). This is done using varimax. A sample graph of the factor loadings is created.The Z matrixes are combined and save into Z.rot.csv and Z.rot4.csv for the 3 and 4 trendlines, respectively. The type is the water quality variable and the year is the respective year, both of which are new variables. The loadings for the four trend lines is graphed

```{r Inverse and Loadings: 4 and 3}
#Find rotated matrix for each year
mod5= MC2015.modobj.nocov$'diagonal and unequal'$m3
# get the inverse of the rotation matrix 
Z.est5 = coef( mod5, type="matrix")$Z
H.inv5 = varimax(Z.est5)$rotmat 
# rotate factor loadings 
Z.rot5 = Z.est5 %*% H.inv5
# rotate trends 
trends.rot5 = solve(H.inv5) %*%  mod5$states

#Find rotated matrix for each year
mod6= MC2016.modobj.nocov$'diagonal and unequal'$m3
# get the inverse of the rotation matrix 
Z.est6 = coef( mod6, type="matrix")$Z
H.inv6 = varimax(Z.est6)$rotmat 
# rotate factor loadings 
Z.rot6 = Z.est6 %*% H.inv6
# rotate trends 
trends.rot6 = solve(H.inv6) %*%  mod6$states

#Find rotated matrix for each year
mod7= MC2017.modobj.nocov$'diagonal and unequal'$m3
# get the inverse of the rotation matrix 
Z.est7 = coef( mod7, type="matrix")$Z
H.inv7 = varimax(Z.est7)$rotmat 
# rotate factor loadings 
Z.rot7 = Z.est7 %*% H.inv7
# rotate trends 
trends.rot7 = solve(H.inv7) %*%  mod7$states

#Find rotated matrix for each year
mod8= MC2018.modobj.nocov$'diagonal and unequal'$m3
# get the inverse of the rotation matrix 
Z.est8 = coef( mod8, type="matrix")$Z
H.inv8 = varimax(Z.est8)$rotmat 
# rotate factor loadings 
Z.rot8 = Z.est8 %*% H.inv8
# rotate trends 
trends.rot8 = solve(H.inv8) %*%  mod8$states

#Find rotated matrix for each year
mods5= SI2015.modobj.nocov$'diagonal and unequal'$m3
# get the inverse of the rotation matrix 
Z.ests5 = coef( mods5, type="matrix")$Z
H.invs5 = varimax(Z.ests5)$rotmat 
# rotate factor loadings 
Z.rots5 = Z.ests5 %*% H.invs5
# rotate trends 
trends.rots5 = solve(H.invs5) %*%  mods5$states

#Find rotated matrix for each year
mods6= SI2016.modobj.nocov$'diagonal and unequal'$m3
# get the inverse of the rotation matrix 
Z.ests6 = coef( mods6, type="matrix")$Z
H.invs6 = varimax(Z.ests6)$rotmat 
# rotate factor loadings 
Z.rots6 = Z.ests6 %*% H.invs6
# rotate trends 
trends.rots6 = solve(H.invs6) %*%  mods6$states

#Find roatated matrix for each year
mods8=SI2018.modobj.nocov$'diagonal and unequal'$m3
# get the inverse of the rotation matrix 
Z.ests8 = coef( mods8, type="matrix")$Z
H.invs8 = varimax(Z.ests8)$rotmat 
# rotate factor loadings 
Z.rots8 = Z.ests8 %*% H.invs8
# rotate trends 
trends.rots8 = solve(H.invs8) %*%  mods8$states

#------------For Four Trends!!!-------------
#MC 2015
Z.est45 = coef( four.dfa.MC2015, type="matrix")$Z
H.inv45 = varimax(Z.est45)$rotmat 
Z.rot45 = Z.est45 %*% H.inv45
trends.rot45 = solve(H.inv45) %*%  four.dfa.MC2015$states

Z.est46 = coef( four.dfa.MC2016, type="matrix")$Z
H.inv46 = varimax(Z.est46)$rotmat 
Z.rot46 = Z.est46 %*% H.inv46
trends.rot46 = solve(H.inv46) %*%  four.dfa.MC2016$states

Z.est47 = coef( four.dfa.MC2017, type="matrix")$Z
H.inv47 = varimax(Z.est47)$rotmat 
Z.rot47 = Z.est47 %*% H.inv47
trends.rot47 = solve(H.inv47) %*%  four.dfa.MC2017$states

Z.est48 = coef( four.dfa.MC2018, type="matrix")$Z
H.inv48 = varimax(Z.est48)$rotmat 
Z.rot48 = Z.est48 %*% H.inv48
trends.rot48 = solve(H.inv48) %*%  four.dfa.MC2018$states

Z.ests45 = coef( four.dfa.SI2015, type="matrix")$Z
H.invs45 = varimax(Z.ests45)$rotmat 
Z.rots45 = Z.ests45 %*% H.invs45
trends.rots45 = solve(H.invs45) %*%  four.dfa.SI2015$states

Z.ests46 = coef( four.dfa.SI2016, type="matrix")$Z
H.invs46 = varimax(Z.ests46)$rotmat 
Z.rots46 = Z.ests46 %*% H.invs46
trends.rots46 = solve(H.invs46) %*%  four.dfa.SI2016$states

Z.ests48 = coef( four.dfa.SI2018, type="matrix")$Z
H.invs48 = varimax(Z.ests48)$rotmat 
Z.rots48 = Z.ests48 %*% H.invs48
trends.rots48 = solve(H.invs48) %*%  four.dfa.SI2018$states


#GRAPH of the factor loadings
#plot the factor loadings 
spp = rownames(MC.2015) 
minZ = 0.00005 
m=dim(trends.rot)[1] 

ylims = c(-1.1*max(abs(Z.rot5)), 1.1*max(abs(Z.rot5))) 
#par(mfrow=c(ceiling(m/2),2), mar=c(3,4,1.5,0.5), oma=c(0.4,1,1,1)) 
for(i in 1:m) { 
  plot(c(1:5)[abs(Z.rot5[,i])>minZ], as.vector(Z.rot5[abs(Z.rot5[,i])>minZ,i]), type="h", lwd=2, xlab="", ylab="", xaxt="n", ylim=ylims, xlim=c(0,6)) 
  for(j in 1:5) { 
    if(Z.rot5[j,i] > minZ) {
      text(j, -0.05, spp[j], srt=90, adj=1, cex=0.9)
      } 
    if(Z.rot5[j,i] < -minZ) {
      text(j, 0.05, spp[j], srt=90, adj=0, cex=0.9)
      } 
    abline(h=0, lwd=1, col="gray") 
    } # end j loop 
  mtext(paste("Factor loadings on trend",i,sep=" "),side=3,line=.5) 
  } # end i loop

#Save the Z matrixes, combine them
Z.rot5x<-as.data.frame(Z.rot5) %>% mutate(Type= spp, Year= c("MC2015"))
Z.rot6x<-as.data.frame(Z.rot6) %>% mutate(Type= spp, Year= c("MC2016"))
Z.rot7x<-as.data.frame(Z.rot7) %>% mutate(Type= spp, Year= c("MC2017"))
Z.rot8x<-as.data.frame(Z.rot8) %>% mutate(Type= spp, Year= c("MC2018"))
Z.rot5sx<-as.data.frame(Z.rots5) %>% mutate(Type= spp, Year= c("SI2015"))
Z.rot6sx<-as.data.frame(Z.rots6) %>% mutate(Type= spp, Year= c("SI2016"))
Z.rot8sx<-as.data.frame(Z.rots8) %>% mutate(Type= spp, Year= c("SI2018"))
Z.rot<- rbind(Z.rot5x, Z.rot6x, Z.rot7x, Z.rot8x, Z.rot5sx, Z.rot6sx, Z.rot8sx)
write.csv(Z.rot, file="Z.rot.csv")


#Save the Z matrixes, combine them: For four trends
Z.rot45x<-as.data.frame(Z.rot45) %>% mutate(Type= spp, Year= c("MC2015"))
Z.rot46x<-as.data.frame(Z.rot46) %>% mutate(Type= spp, Year= c("MC2016"))
Z.rot47x<-as.data.frame(Z.rot47) %>% mutate(Type= spp, Year= c("MC2017"))
Z.rot48x<-as.data.frame(Z.rot48) %>% mutate(Type= spp, Year= c("MC2018"))
Z.rot45sx<-as.data.frame(Z.rots45) %>% mutate(Type= spp, Year= c("SI2015"))
Z.rot46sx<-as.data.frame(Z.rots46) %>% mutate(Type= spp, Year= c("SI2016"))
Z.rot48sx<-as.data.frame(Z.rots48) %>% mutate(Type= spp, Year= c("SI2018"))
Z.rot4<- rbind(Z.rot45x, Z.rot46x, Z.rot47x, Z.rot48x, Z.rot45sx, Z.rot46sx, Z.rot48sx)
write.csv(Z.rot4, file="Z.rot4.csv")

#GRAPHS showing the loadings for each of the 4 trend lines

#Trend 1
ggplot(data= Z.rot4 ) +
  geom_linerange(mapping=aes(x=Type, ymin=0, ymax= V1, color=Year), stat= "identity", size= 1.25, position = position_dodge(width=1))+
  scale_x_discrete(labels=c("BGAugL" = "Blue-Green Algae", "CHLugL" = "Chlorophyll",
                              "FDOMqsu" = "Dissolved \n Organic Matter", "NO3_mgL"= "Nitrate", "Turb"= "Turbidity"))+
  labs(x= "Water Quality Constituent")+
  theme(panel.grid.major.x = element_blank()) +
  geom_hline(yintercept=0,color= "black") +
  geom_vline(xintercept=c(1.5, 2.5, 3.5, 4.5), color= "white", size=1.5)+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018", "Backwater 2015", "Backwater 2016", "Backwater 2018")) +
  ggtitle("Loadings for Trend One")

#Trend 2
ggplot(data= Z.rot4 ) +
  geom_linerange(mapping=aes(x=Type, ymin=0, ymax= V2, color=Year), stat= "identity", size= 1.25, position = position_dodge(width=1))+
  scale_x_discrete(labels=c("BGAugL" = "Blue-Green Algae", "CHLugL" = "Chlorophyll",
                              "FDOMqsu" = "Dissolved \n Organic Matter", "NO3_mgL"= "Nitrate", "Turb"= "Turbidity"))+
  labs(x= "Water Quality Constituent")+
  theme(panel.grid.major.x = element_blank()) +
  geom_hline(yintercept=0,color= "black") +
  geom_vline(xintercept=c(1.5, 2.5, 3.5, 4.5), color= "white", size=1.5)+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018", "Backwater 2015", "Backwater 2016", "Backwater 2018")) +
  ggtitle("Loadings for Trend Two")

#Trend 3
ggplot(data= Z.rot4 ) +
  geom_linerange(mapping=aes(x=Type, ymin=0, ymax= V3, color=Year), stat= "identity", size= 1.25, position = position_dodge(width=1))+
  scale_x_discrete(labels=c("BGAugL" = "Blue-Green Algae", "CHLugL" = "Chlorophyll",
                              "FDOMqsu" = "Dissolved \n Organic Matter", "NO3_mgL"= "Nitrate", "Turb"= "Turbidity"))+
  labs(x= "Water Quality Constituent")+
  theme(panel.grid.major.x = element_blank()) +
  geom_hline(yintercept=0,color= "black") +
  geom_vline(xintercept=c(1.5, 2.5, 3.5, 4.5), color= "white", size=1.5)+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018", "Backwater 2015", "Backwater 2016", "Backwater 2018")) +
  #facet_wrap(~Year)+
  ggtitle("Loadings for Trend Three")

#Trend Four
ggplot(data= Z.rot4 ) +
  geom_linerange(mapping=aes(x=Type, ymin=0, ymax= V4, color=Year), stat= "identity", size= 1.25, position = position_dodge(width=1))+
  scale_x_discrete(labels=c("BGAugL" = "Blue-Green Algae", "CHLugL" = "Chlorophyll",
                              "FDOMqsu" = "Dissolved \n Organic Matter", "NO3_mgL"= "Nitrate", "Turb"= "Turbidity"))+
  labs(x= "Water Quality Constituent")+
  theme(panel.grid.major.x = element_blank()) +
  geom_hline(yintercept=0,color= "black") +
  geom_vline(xintercept=c(1.5, 2.5, 3.5, 4.5), color= "white", size=1.5)+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018", "Backwater 2015", "Backwater 2016", "Backwater 2018")) +
  #facet_wrap(~Year)+
  ggtitle("Loadings for Trend Four")
```

Below, the trendlines are combined for each of the 4 and 3 trendlines. The num is the day, where the first day is the first day of collection in 2016. The trendlines are plotted (for the 4 trendlines). Each year is given its own 'type' in a new variable

```{r Trend: for 3 and 4}

#Graphs showing the trendlines 

ylbl<- rownames(MC.2015)
w_ts <- seq(dim(MC.2015)[2])
N_ts <- dim(MC.2015)[1]
clr <- c("brown","blue","darkgreen","darkred","purple")


#Save the trends for main channel and backwater
trends.rot<- rbind(as.data.frame(t(trends.rot5)) %>% mutate( num= c(85:171)) %>% mutate(Type= c("MC2015")), 
                   as.data.frame(t(trends.rot6)) %>% mutate( num= c(1:204)) %>% mutate(Type= c("MC2016")),
                   as.data.frame(t(trends.rot7)) %>% mutate( num= c(58:177)) %>% mutate(Type= c("MC2017")),
                   as.data.frame(t(trends.rot8)) %>% mutate( num= c(50:171)) %>% mutate(Type= c("MC2018")))
trends.rots<- rbind(as.data.frame(t(trends.rots5)) %>% mutate( num= c(50:186)) %>% mutate(Type= c("SI2015")), 
                   as.data.frame(t(trends.rots6)) %>% mutate( num= c(1:185)) %>% mutate(Type= c("SI2016")),
                   as.data.frame(t(trends.rots8)) %>% mutate( num= c(40:178)) %>% mutate(Type= c("SI2018")))
write.csv(trends.rot, file="MCtrends.rot.csv")
write.csv(trends.rots, file="SItrends.rot.csv")

#Four trends
trends.rot4<- rbind(as.data.frame(t(trends.rot45)) %>% mutate( num= c(85:171)) %>% mutate(Type= c("MC2015")), 
                   as.data.frame(t(trends.rot46)) %>% mutate( num= c(1:204)) %>% mutate(Type= c("MC2016")),
                   as.data.frame(t(trends.rot47)) %>% mutate( num= c(58:177)) %>% mutate(Type= c("MC2017")),
                   as.data.frame(t(trends.rot48)) %>% mutate( num= c(50:171)) %>% mutate(Type= c("MC2018")))
trends.rots4<- rbind(as.data.frame(t(trends.rots45)) %>% mutate( num= c(50:186)) %>% mutate(Type= c("SI2015")), 
                   as.data.frame(t(trends.rots46)) %>% mutate( num= c(1:185)) %>% mutate(Type= c("SI2016")),
                   as.data.frame(t(trends.rots48)) %>% mutate( num= c(40:178)) %>% mutate(Type= c("SI2018")))
write.csv(trends.rot4, file="MCtrends.rot4.csv")
write.csv(trends.rots4, file="SItrends.rot4.csv")

#Main Channel Trend 1
ggplot(data= trends.rot4) +
  geom_line(mapping= aes(x=num, y= V1, color= Type), size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-6, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Trend")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018")) +
  ggtitle("Trend One in Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#Main Channel Trend 2
ggplot(data= trends.rot4) +
  geom_line(mapping= aes(x=num, y= V2, color= Type), size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-6, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Trend")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018")) +
  ggtitle("Trend Two in Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#Main Channel Trend 3
ggplot(data= trends.rot) +
  geom_line(mapping= aes(x=num, y= V3, color= Type), size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-11, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Trend")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018")) +
  ggtitle("Trend Three in Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#Main Channel Trend 4
ggplot(data= trends.rot4) +
  geom_line(mapping= aes(x=num, y= V4, color= Type), size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-11, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Trend")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018")) +
  ggtitle("Trend Three in Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#Backwater Trend 1
ggplot(data= trends.rots4) +
  geom_line(mapping= aes(x=num, y= V1, color= Type), size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-6, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Trend")+
  scale_color_manual(values= c("#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Backwater 2015", "Backwater 2016",  "Backwater 2018")) +
  ggtitle("Trend One in Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#Backwater Trend 2
ggplot(data= trends.rots4) +
  geom_line(mapping= aes(x=num, y= V2, color= Type), size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-6, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Trend")+
  scale_color_manual(values= c("#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Backwater 2015", "Backwater 2016",  "Backwater 2018")) +
  ggtitle("Trend Two in Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#Backwater trend 3
ggplot(data= trends.rots4) +
  geom_line(mapping= aes(x=num, y= V3, color= Type), size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-7, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Trend")+
  scale_color_manual(values= c("#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Backwater 2015", "Backwater 2016", "Backwater 2018")) +
  ggtitle("Trend Three in Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#Backwater trend 4
ggplot(data= trends.rots4) +
  geom_line(mapping= aes(x=num, y= V4, color= Type), size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-7, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Trend")+
  scale_color_manual(values= c("#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Backwater 2015", "Backwater 2016", "Backwater 2018")) +
  ggtitle("Trend Three in Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
?scale_x
```


Below, the trendlines are graphed with discharge, to see the comparison between discharge and the trendlines. The correlation is found. This is for the 4-trendline data. There is a new graph for each year/location

```{r Trend and Discharge}
#Graphing discharge against each trend line, does show similarity
ggplot((data=trends.rot4 %>% filter(Type=='MC2015')))+ 
  geom_line(mapping=aes(x=num, y=V1, color="#D55E00"))+
  geom_line(mapping=aes(x=num, y=V2, color="#0072B2"))+
  geom_line(mapping=aes(x=num, y=V3, color="#F0E442"))+
  geom_line(mapping=aes(x=num, y=V4, color="#009E73"))+
  geom_line(data=(MC.2015.rawc %>% mutate(num=85:171)), mapping=aes(x=num, y=(Discharge/5000)-4, color="black"), size=2.5)+
  guides(color = guide_legend(reverse=F,title="Line"))+
  scale_colour_identity(breaks=c("#D55E00", "#0072B2", "#F0E442", "#009E73", "black"), labels= c("Trend 1", "Trend 2", "Trend 3", "Trend 4", "Discharge"), guide="legend")

#Correlation between each trendline and the discharge for the given year
cor(trends.rot45[1,], MC.2015.rawc$Discharge)
cor(trends.rot45[2,], MC.2015.rawc$Discharge)
cor(trends.rot45[3,], MC.2015.rawc$Discharge)
cor(trends.rot45[4,], MC.2015.rawc$Discharge)


ggplot((data=trends.rot4 %>% filter(Type=='MC2016')))+ 
  geom_line(mapping=aes(x=num, y=V1, color="#D55E00"))+
  geom_line(mapping=aes(x=num, y=V2, color="#0072B2"))+
  geom_line(mapping=aes(x=num, y=V3, color="#F0E442"))+
  geom_line(mapping=aes(x=num, y=V4, color="#009E73"))+
  geom_line(data=(MC.2016.raw %>% mutate(num=1:204)), mapping=aes(x=num, y=(Discharge/5000)-4, color="black"), size=2.5)+
  guides(color = guide_legend(reverse=F,title="Line"))+
  scale_colour_identity(breaks=c("#D55E00", "#0072B2", "#F0E442", "#009E73", "black"), labels= c("Trend 1", "Trend 2", "Trend 3", "Trend 4", "Discharge"), guide="legend")

cor(trends.rot46[1,], MC.2016.raw$Discharge)
cor(trends.rot46[2,], MC.2016.raw$Discharge)
cor(trends.rot46[3,], MC.2016.raw$Discharge)
cor(trends.rot46[4,], MC.2016.raw$Discharge)

ggplot((data=trends.rot4 %>% filter(Type=='MC2017')))+ 
  geom_line(mapping=aes(x=num, y=V1, color="#D55E00"))+
  geom_line(mapping=aes(x=num, y=V2, color="#0072B2"))+
  geom_line(mapping=aes(x=num, y=V3, color="#F0E442"))+
  geom_line(mapping=aes(x=num, y=V4, color="#009E73"))+
  geom_line(data=(MC.2017.raw %>% mutate(num=58:177)), mapping=aes(x=num, y=(Discharge/5000)-4, color="black"), size=2.5)+
  guides(color = guide_legend(reverse=F,title="Line"))+
  scale_colour_identity(breaks=c("#D55E00", "#0072B2", "#F0E442", "#009E73", "black"), labels= c("Trend 1", "Trend 2", "Trend 3", "Trend 4", "Discharge"), guide="legend")


cor(trends.rot47[1,], MC.2017.raw$Discharge)
cor(trends.rot47[2,], MC.2017.raw$Discharge)
cor(trends.rot47[3,], MC.2017.raw$Discharge)
cor(trends.rot47[4,], MC.2017.raw$Discharge)

ggplot((data=trends.rot4 %>% filter(Type=='MC2018')))+ 
  geom_line(mapping=aes(x=num, y=V1, color="#D55E00"))+
  geom_line(mapping=aes(x=num, y=V2, color="#0072B2"))+
  geom_line(mapping=aes(x=num, y=V3, color="#F0E442"))+
  geom_line(mapping=aes(x=num, y=V4, color="#009E73"))+
  geom_line(data=(MC.2018.raw %>% mutate(num=50:171)), mapping=aes(x=num, y=(Discharge/5000)-4, color="black"), size=2.5)+
  guides(color = guide_legend(reverse=F,title="Line"))+
  scale_colour_identity(breaks=c("#D55E00", "#0072B2", "#F0E442", "#009E73", "black"), labels= c("Trend 1", "Trend 2", "Trend 3", "Trend 4", "Discharge"), guide="legend")

cor(trends.rot48[1,], MC.2018.raw$Discharge)
cor(trends.rot48[2,], MC.2018.raw$Discharge)
cor(trends.rot48[3,], MC.2018.raw$Discharge)
cor(trends.rot48[4,], MC.2018.raw$Discharge)

ggplot((data=trends.rots4 %>% filter(Type=='SI2015')))+ 
  geom_line(mapping=aes(x=num, y=V1, color="#D55E00"))+
  geom_line(mapping=aes(x=num, y=V2, color="#0072B2"))+
  geom_line(mapping=aes(x=num, y=V3, color="#F0E442"))+
  geom_line(mapping=aes(x=num, y=V4, color="#009E73"))+
  geom_line(data=(SI.2015.rawc %>% mutate(num=50:186)), mapping=aes(x=num, y=(Discharge/5000)-4, color="black"), size=2.5)+
  guides(color = guide_legend(reverse=F,title="Line"))+
  scale_colour_identity(breaks=c("#D55E00", "#0072B2", "#F0E442", "#009E73", "black"), labels= c("Trend 1", "Trend 2", "Trend 3", "Trend 4", "Discharge"), guide="legend")

cor(trends.rots45[1,], SI.2015.rawc$Discharge)
cor(trends.rots45[2,], SI.2015.rawc$Discharge)
cor(trends.rots45[3,], SI.2015.rawc$Discharge)
cor(trends.rots45[4,], SI.2015.rawc$Discharge)

ggplot((data=trends.rots4 %>% filter(Type=='SI2016')))+ 
  geom_line(mapping=aes(x=num, y=V1, color="#D55E00"))+
  geom_line(mapping=aes(x=num, y=V2, color="#0072B2"))+
  geom_line(mapping=aes(x=num, y=V3, color="#F0E442"))+
  geom_line(mapping=aes(x=num, y=V4, color="#009E73"))+
  geom_line(data=(SI.2016.raw %>% mutate(num=1:185)), mapping=aes(x=num, y=(Discharge/5000)-4, color="black"), size=2.5)+
  guides(color = guide_legend(reverse=F,title="Line"))+
  scale_colour_identity(breaks=c("#D55E00", "#0072B2", "#F0E442", "#009E73", "black"), labels= c("Trend 1", "Trend 2", "Trend 3", "Trend 4", "Discharge"), guide="legend")

cor(trends.rots46[1,], SI.2016.raw$Discharge)
cor(trends.rots46[2,], SI.2016.raw$Discharge)
cor(trends.rots46[3,], SI.2016.raw$Discharge)
cor(trends.rots46[4,], SI.2016.raw$Discharge)

ggplot((data=trends.rots4 %>% filter(Type=='SI2018')))+ 
  geom_line(mapping=aes(x=num, y=V1, color="#D55E00"))+
  geom_line(mapping=aes(x=num, y=V2, color="#0072B2"))+
  geom_line(mapping=aes(x=num, y=V3, color="#F0E442"))+
  geom_line(mapping=aes(x=num, y=V4, color="#009E73"))+
  geom_line(data=(SI.2018.rawc %>% mutate(num=40:178)), mapping=aes(x=num, y=(Discharge/5000)-4, color="black"), size=2.5)+
  guides(color = guide_legend(reverse=F,title="Line"))+
  scale_colour_identity(breaks=c("#D55E00", "#0072B2", "#F0E442", "#009E73", "black"), labels= c("Trend 1", "Trend 2", "Trend 3", "Trend 4", "Discharge"), guide="legend")

cor(trends.rots48[1,], SI.2018.rawc$Discharge)
cor(trends.rots48[2,], SI.2018.rawc$Discharge)
cor(trends.rots48[3,], SI.2018.rawc$Discharge)
cor(trends.rots48[4,], SI.2018.rawc$Discharge)

#"#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"
  
```

Sample graphs for the analysis, testing functions and inputs/outputs

```{r Sample Fit Graphs}

require(broom)
require(ggplot2)
theme_set(theme_bw())
d <- augment(mod6, interval="confidence")
ggplot(data = d) +
geom_line(aes(t, .fitted)) +
geom_point(aes(t, y)) +
geom_ribbon(aes(x=t, ymin=.conf.low, ymax=.conf.up), linetype=2, alpha=0.2) +
facet_wrap(~.rownames, scales="free_y") +
xlab("Time Step") + ylab("Count")

?facet_wrap



get_DFA_fits <- function(MLEobj,dd=NULL,alpha=0.05) {
  
  ## empty list for results
  fits <- list()
  ## extra stuff for var() calcs
  Ey <- MARSS:::MARSShatyt(MLEobj)
  ## model params
	ZZ <- coef(MLEobj, type="matrix")$Z
	## number of obs ts
	nn <- dim(Ey$ytT)[1]
	## number of time steps
	TT <- dim(Ey$ytT)[2]
	## get the inverse of the rotation matrix
	H_inv <- varimax(ZZ)$rotmat
	## check for covars
	# if(!is.null(dd)) {
	#   DD <- coef(MLEobj, type="matrix")$D
	#   ## model expectation
	#   fits$ex <- ZZ %*% H_inv %*% MLEobj$states + DD %*% dd
	# } else {
	  ## model expectation
	  fits$ex <- ZZ %*% H_inv %*% MLEobj$states
	#}
	## Var in model fits
 	VtT <- MARSSkfss(MLEobj)$VtT
 	VV <- NULL
 	for(tt in 1:TT) {
 	  RZVZ <- coef(MLEobj, type="matrix")$R - ZZ%*%VtT[,,tt]%*%t(ZZ)
 	  SS <- Ey$yxtT[,,tt] - Ey$ytT[,tt,drop=FALSE] %*% t(MLEobj$states[,tt,drop=FALSE])
 	  VV <- cbind(VV,diag(RZVZ + SS%*%t(ZZ) + ZZ%*%t(SS)))
	  }
  	SE <- sqrt(VV)
 	## upper & lower (1-alpha)% CI
 	fits$up <- qnorm(1-alpha/2)*SE + fits$ex
 	fits$lo <- qnorm(alpha/2)*SE + fits$ex
 	return(fits)
}

ylbl<- c("Turbidity \n (NTU)", "Cholorphyll-a \n (ugL)", "Blue-green \n algae (ugL)", "Dissolved \n Organic \n Matter (qsu)", "Nitrate \n (mgL)")

#2018 Main Channel
## get model fits & CI's
mod_fit <- get_DFA_fits(mod8, alpha= .05)
w_ts <- seq(dim(MC.2018)[2])
## plot the fits
par(mfrow=c(5,1), mai=c(0.05,0.7,0,0.3), omi=c(0,0,0,0))
for(i in 1:5) {
 # up <- mod_fit$up[i,]
  mn <- mod_fit$ex[i,]
  #lo <- mod_fit$lo[i,]
  plot(w_ts,mn,xlab="Time",ylab=ylbl[i],xaxt="n",type="n", cex.lab=1.2,
       ylim=c(min(lo),(max(up))))
  points(w_ts,MC.2018[i,], pch=16, col=clr[i])
  #lines(w_ts, up, col="darkgray")
  lines(w_ts, mn, col="black", lwd=2)
  #lines(w_ts, lo, col="darkgray")
}



modd8= MC2018.modobj.dis$'diagonal and unequal'$m3
modsd8= SI2018.modobj.dis$'diagonal and unequal'$m3

#MC
#Discharge vs No covariate
mod_fit1 <- get_DFA_fits(mod8, alpha= .05)
mod_fit2 <- get_DFA_fits(modd8, alpha= .05)
w_ts <- seq(dim(MC.2018)[2])

par(mfrow=c(5,1), mai=c(0.05,0.7,0,0.3), omi=c(0,0,0,0))
for(i in 1:5) {
  mn1 <- mod_fit1$ex[i,]
  mn2 <- mod_fit2$ex[i,]
  plot(w_ts,mn1,xlab="Time",ylab=ylbl[i],xaxt="n",type="n", cex.lab=1.2,
       ylim=c(min(lo),(max(MC.2018[i,]))))
  points(w_ts,MC.2018[i,], pch=16, col="gray")
  lines(w_ts, mn1, col="red", lwd=2)
  lines(w_ts, mn2, col= "blue", lwd= 2)
  if(i==4){
    legend(30, -1, legend=c("No Covariates", "Discharge"),
       col=c("red", "blue"), lty= 1,  text.font=10)
  }
}

#SI
#Discharge vs No covariate
mod_fit1 <- get_DFA_fits(mods8, alpha= .05)
mod_fit2 <- get_DFA_fits(modsd8, alpha= .05)
w_ts <- seq(dim(SI.2018)[2])

par(mfrow=c(5,1), mai=c(0.05,0.7,0,0.3), omi=c(0,0,0,0))
for(i in 1:5) {
  mn1 <- mod_fit1$ex[i,]
  mn2 <- mod_fit2$ex[i,]
  plot(w_ts,mn1,xlab="Time",ylab=ylbl[i],xaxt="n",type="n", cex.lab=1.2,
       ylim=c(min(lo),(max(SI.2018[i,]))))
  points(w_ts,SI.2018[i,], pch=16, col="gray")
  lines(w_ts, mn1, col="red", lwd=2)
  lines(w_ts, mn2, col= "blue", lwd= 2)
  if(i==5){
    legend(30, 0, legend=c("No Covariates", "Discharge"),
       col=c("red", "blue"), lty= 1,  text.font=10)
  }
}
#Look at difference
mod_fit$up[, 1:15]
mod_fit$ex[, 1:15]
```

Graphs of the actual data vs the fit, only done for the 3 trendline analysis. Not the most helpful. Uses a function previously named, get_DFA_fits, in the above sections

```{r BW vs MC For fit, 3 trends}
#Not corrected for 4 trends
mod_fitm <- get_DFA_fits(mod6, alpha= .05)
w_ts <- seq(dim(MC.2016)[2])
## plot the fits
par(mfrow=c(5,1), mai=c(0.05,0.7,0,0.3), omi=c(0,0,0,0))
for(i in 1:5) {
  up <- mod_fitm$up[i,]
  mn <- mod_fitm$ex[i,]
  lo <- mod_fitm$lo[i,]
  plot(w_ts,mn,xlab="Time",ylab=ylbl[i],xaxt="n",type="n", cex.lab=1.2,
       ylim=c(min(lo),(max(up))))
  points(w_ts,MC.2016[i,], pch=16, col="gray")
  lines(w_ts, mn, col="black", lwd=2)
}

mod_fitb <- get_DFA_fits(mods6, alpha= .05)
w_ts <- seq(dim(SI.2016)[2])
par(mfrow=c(5,1), mai=c(0.05,0.7,0,0.3), omi=c(0,0,0,0))
for(i in 1:5) {
  up <- mod_fitb$up[i,]
  mn <- mod_fitb$ex[i,]
  lo <- mod_fitb$lo[i,]
  plot(w_ts,mn,xlab="Time",ylab=ylbl[i],xaxt="n",type="n", cex.lab=1.2,
       ylim=c(min(lo),(max(up))))
  points(w_ts,SI.2016[i,], pch=16, col="gray")
  lines(w_ts, mn, col="black", lwd=2)
}

```

Below is a graph of the sum of the loadings for each consitutent (this is for 4 trendlines)
Addtionally, there is a graph to visualize the loadings for MC 2015 for the 3 trendlines (better graph in Chunk 7)
Loop through to find the difference between the loadings for each trendline, as well as the association (positive:both in the same direction, negative: in different directions). There are two graphs to visualize each of these. This is for THREE trendlines, four is below

```{r 3 trend Loadings by Year}
#SUM of the loadings for each yr/location
Z.rot4<-Z.rot4 %>% mutate(Sum1= (V1+V2+V3+V4))
Z.rot4<-Z.rot4 %>% select(!Sum) %>% rename(SUM=Sum1)

#Graph the sum of the loadings for each constituent 
ggplot(data= Z.rot4 ) +
  geom_linerange(mapping=aes(x=Type, ymin=0, ymax= SUM, color=Year),  size= 1.25, position = position_dodge(width=1))+
  scale_x_discrete(labels=c("BGAugL" = "Blue-Green Algae", "CHLugL" = "Chlorophyll",
                              "FDOMqsu" = "Dissolved \n Organic Matter", "NO3_mgL"= "Nitrate", "Turb"= "Turbidity"))+
  labs(x= "Water Quality Constituent", y="Sum of Loadings for all Trendlines")+
  theme(panel.grid.major.x = element_blank()) +
  geom_hline(yintercept=0,color= "black") +
  geom_vline(xintercept=c(1.5, 2.5, 3.5, 4.5), color= "white", size=1.5)+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"), name= "Data", labels=c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018", "Backwater 2015", "Backwater 2016", "Backwater 2018")) +
  ggtitle("Sum of Loadings")


Z1<- c(Z.rot5x[,1], Z.rot5x[,2], Z.rot5x[,3])
Zdf5<- data.frame(Loadings= c(Z1), Trend= c('V1', 'V1', 'V1', 'V1', 'V1', 'V2', 'V2', 'V2', 'V2', 'V2', 'V3', 'V3', 'V3', 'V3', 'V3'), Variable= c(spp))

#Visualize the loadings for MC 2015 for each variable for the 3 trend lines
ggplot(data= Zdf5) +
  geom_linerange(mapping=aes(x=Trend, ymin=0, ymax= Loadings, color=Variable), size= 1.25, position = position_dodge(width=1))+
  scale_x_discrete(labels=c("V1" = "1", "V2" = "2",
                              "V3" = "3"))+
  geom_vline(xintercept=c(1.5, 2.5), color= "white", size=1.5)+
  scale_color_manual(values= c( "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2"), name="Variable", labels=c("Turbidity", "Chlorophyll-a", "Blue-Green Algae", "Fluorescent Dissolved \n Organic Matter", "Nitrate"))+
  labs(x= "Trend", y="Loadings")+
  theme(panel.grid.major.x = element_blank()) +
  geom_hline(yintercept=0,color= "black") +
  ggtitle("Loadings for Main Channel in 2015")


#LOOPS to find the differences and associations, stored in Loadings.dif
Variables= c("Turb", "CHL-a", "BGA", "FDOM", "NO3")
Trends= c(1, 2, 3)
Loadings.dif = data.frame() #list to save model objects 
#MC2015
for(k in 1:3){#loop over 1-3 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot5x[i,k]<0 & Z.rot5x[j,k]>0) | (Z.rot5x[i,k]>0 & Z.rot5x[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif = rbind(Loadings.dif, 
                                     data.frame(x=abs(Z.rot5x[i,k]-Z.rot5x[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "MC2015",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop
#MC2016
for(k in 1:3){#loop over 1-3 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot6x[i,k]<0 & Z.rot6x[j,k]>0) | (Z.rot6x[i,k]>0 & Z.rot6x[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif = rbind(Loadings.dif, 
                                     data.frame(x=abs(Z.rot6x[i,k]-Z.rot6x[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "MC2016",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

#MC2017
for(k in 1:3){#loop over 1-3 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot7x[i,k]<0 & Z.rot7x[j,k]>0) | (Z.rot7x[i,k]>0 & Z.rot7x[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif = rbind(Loadings.dif, 
                                     data.frame(x=abs(Z.rot7x[i,k]-Z.rot7x[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "MC2017",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

#MC 2018
for(k in 1:3){#loop over 1-3 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot8x[i,k]<0 & Z.rot8x[j,k]>0) | (Z.rot8x[i,k]>0 & Z.rot8x[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif = rbind(Loadings.dif, 
                                     data.frame(x=abs(Z.rot8x[i,k]-Z.rot8x[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "MC2018",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop


#SI 2015
for(k in 1:3){#loop over 1-3 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot5sx[i,k]<0 & Z.rot5sx[j,k]>0) | (Z.rot5sx[i,k]>0 & Z.rot5sx[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif = rbind(Loadings.dif, 
                                     data.frame(x=abs(Z.rot5sx[i,k]-Z.rot5sx[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "SI2015",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

for(k in 1:3){#loop over 1-3 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot6sx[i,k]<0 & Z.rot6sx[j,k]>0) | (Z.rot6sx[i,k]>0 & Z.rot6sx[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif = rbind(Loadings.dif, 
                                     data.frame(x=abs(Z.rot6sx[i,k]-Z.rot6sx[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "SI2016",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

for(k in 1:3){#loop over 1-3 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot8sx[i,k]<0 & Z.rot8sx[j,k]>0) | (Z.rot8sx[i,k]>0 & Z.rot8sx[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif = rbind(Loadings.dif, 
                                     data.frame(x=abs(Z.rot8sx[i,k]-Z.rot8sx[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "SI2018",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

ggplot(data= Loadings.dif) +
  geom_boxplot(mapping=aes(x=Type, y=x))+
  scale_x_discrete(labels=c("BGA \n FDOM", "BGA \n NO3", "CHL-a \n BGA", "CHL-a \n FDOM", "CHL-a \n NO3", "FDOM \n NO3", "Turb \n BGA", "Turb \n CHL", "Turb \n FDOM", "Turb \n NO3")) + labs(x= "Pairings", y="Absolute Value of the Difference Between Loadings", title= "Average Difference Between Loadings for Water Quality Variable Pairs")
  
  
ggplot(data= Loadings.dif)+
  geom_bar(mapping=aes(x= Type, fill= Asc), position="stack") +
  scale_x_discrete(labels=c("BGA \n FDOM", "BGA \n NO3", "CHL-a \n BGA", "CHL-a \n FDOM", "CHL-a \n NO3", "FDOM \n NO3", "Turb \n BGA", "Turb \n CHL", "Turb \n FDOM", "Turb \n NO3")) +
   scale_fill_manual(values= c("#D55E00", "#009E73"), name= "Correlation", labels= c("Negative", "Postitive")) +
  labs(x="Pairs of Constituents", y="Count")+
  #facet_wrap(~Trend)
  ggtitle("Loadings Associations")

write.csv(Loadings.dif, "Loadingsdif.csv", row.names = FALSE)

```

Same process as above but with 4 trendlines

```{r 4 Trends Loadings Dif and Asc}

#Loops t find the differences and associations, stored in loadings.dif4
Variables= c("Turb", "CHL-a", "BGA", "FDOM", "NO3")
Trends= c(1, 2, 3, 4)
Loadings.dif4 = data.frame() #list to save model objects 
#MC2015
for(k in 1:4){ #loop over 1-4 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot45x[i,k]<0 & Z.rot45x[j,k]>0) | (Z.rot45x[i,k]>0 & Z.rot45x[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif4 = rbind(Loadings.dif4, 
                                     data.frame(x=abs(Z.rot45x[i,k]-Z.rot45x[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "MC2015",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop
#MC2016
for(k in 1:4){ #loop over 1-4 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot46x[i,k]<0 & Z.rot46x[j,k]>0) | (Z.rot46x[i,k]>0 & Z.rot46x[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif4 = rbind(Loadings.dif4, 
                                     data.frame(x=abs(Z.rot46x[i,k]-Z.rot46x[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "MC2016",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

#MC2017
for(k in 1:4){ #loop over 1-4 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot47x[i,k]<0 & Z.rot47x[j,k]>0) | (Z.rot47x[i,k]>0 & Z.rot47x[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif4 = rbind(Loadings.dif4, 
                                     data.frame(x=abs(Z.rot47x[i,k]-Z.rot47x[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "MC2017",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

#MC 2018
for(k in 1:4){ #loop over 1-4 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot48x[i,k]<0 & Z.rot48x[j,k]>0) | (Z.rot48x[i,k]>0 & Z.rot48x[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif4 = rbind(Loadings.dif4, 
                                     data.frame(x=abs(Z.rot48x[i,k]-Z.rot48x[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "MC2018",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop


#SI 2015
for(k in 1:4){ #loop over 1-4 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot45sx[i,k]<0 & Z.rot45sx[j,k]>0) | (Z.rot45sx[i,k]>0 & Z.rot45sx[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif4 = rbind(Loadings.dif4, 
                                     data.frame(x=abs(Z.rot45sx[i,k]-Z.rot45sx[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "SI2015",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

for(k in 1:4){ #loop over 1-4 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot46sx[i,k]<0 & Z.rot46sx[j,k]>0) | (Z.rot46sx[i,k]>0 & Z.rot46sx[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif4 = rbind(Loadings.dif4, 
                                     data.frame(x=abs(Z.rot46sx[i,k]-Z.rot46sx[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "SI2016",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop

for(k in 1:4){ #loop over 1-4 trends
  for(i in 1:4) { #loop over the first item in the pair
    for(j in (i+1):5) {
      if((Z.rot48sx[i,k]<0 & Z.rot48sx[j,k]>0) | (Z.rot48sx[i,k]>0 & Z.rot48sx[j,k]<0)){
        asc= "Neg"
      }
      else{
        asc="Pos"
      }
      Loadings.dif4 = rbind(Loadings.dif4, 
                                     data.frame(x=abs(Z.rot48sx[i,k]-Z.rot48sx[j,k]), 
                                                Type= paste(Variables[i],Variables[j], sep="-"), 
                                                Trend= paste("V", k, sep=""),
                                                Year= "SI2018",
                                                Asc= asc))
      } #end i loop
    } # end i loop 
  }#end k loop


ggplot(data= Loadings.dif4) +
  geom_boxplot(mapping=aes(x=reorder(Type, x, median), y=x))+
  scale_x_discrete(labels=c("BGA \n FDOM", "BGA \n NO3", "CHL-a \n BGA", "CHL-a \n FDOM", "CHL-a \n NO3", "FDOM \n NO3", "Turb \n BGA", "Turb \n CHL", "Turb \n FDOM", "Turb \n NO3")) + 
  labs(x= "Pairings", y="Absolute Value of the Difference Between Loadings", title= "Average Difference Between Loadings for Water Quality Variable Pairs")
  
  
ggplot(data= Loadings.dif4)+
  geom_bar(mapping=aes(x=reorder(Type, x, median), fill= Asc), position="stack") +
  scale_x_discrete(labels=c("BGA \n FDOM", "BGA \n NO3", "CHL-a \n BGA", "CHL-a \n FDOM", "CHL-a \n NO3", "FDOM \n NO3", "Turb \n BGA", "Turb \n CHL", "Turb \n FDOM", "Turb \n NO3")) +
   scale_fill_manual(values= c("#D55E00", "#009E73"), name= "Correlation", labels= c("Negative", "Postitive")) +
  labs(x="Pairs of Constituents", y="Count")+
  #facet_wrap(~Trend)
  ggtitle("Loadings Associations")


#Savingand combining all of the pairs info to graph
pairs<- Loadings.dif4[1:10,2] #Saving pair names
Correlations= data.frame()

Loadings.dif4[Loadings.dif4$Type=='Turb-CHL-a',]
Loadings.dif4[Loadings.dif4$Type=='Turb-CHL-a',][,5]=='Pos'
sum(Loadings.dif4[Loadings.dif4$Type=='Turb-CHL-a',][,5]=='Pos')

for(i in 1:10){
  Correlations[i,1] = pairs[i]
  Correlations[i, 2] = median(Loadings.dif4[Loadings.dif4$Type==pairs[i],][,1])
  Correlations[i, 3] =sum(Loadings.dif4[Loadings.dif4$Type==pairs[i],][,5]=='Pos')
}

colnames(Correlations)<-c("Pair", "Median", "PosCount")


#Looking at correlations of loadings. This is a really great graph combining associations and differences
ggplot(data=Correlations) +
  geom_point(mapping=aes(x=Median, y=PosCount), color= "#0072B2", size=2)+
  geom_text(aes(Median, PosCount, label=c("Turb \n CHL-a", "Turb \n BGA", "FDOM \n Turb", "NO3 \n Turb", "CHL-a \n BGA", "FDOM \n CHL-a", "NO3 \n CHL-a", "BGA \n FDOM", "NO3 \n BGA", "NO3 \n FDOM")), nudge_x= c(.015,.008, -.015, .015, .015, .015, .015, -.015, -.015, .015), size=3.5)+ 
  labs(title= "Correlations between Loadings for Pairs of Constituents", x= "Median Difference between Loadings", y= "Count of Loadings in the Same Direction for each Pair \n (Out of 28)")+
  annotate(geom= "label", x=c(.08, .4, .35), y=c(23.25,12.5, 20), label=c("Strong \n Correlation", "Weak \n Correlation", "FDOM: Fluorescent Dissolved \n Organic Matter \n BGA: Blue-Green Algae \n CHL-a: Chlorophyll-a \n NO3: Nitrate \n Turb: Turbidity"), color= c("#D55E00", "#D55E00", "black"))

write.csv(Loadings.dif4, "Loadingsdif4.csv", row.names = FALSE)
#"#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"
```

SOme DFA runs to see if there is anything that works better (different covariates, groupings, etc)

```{r DFA Quick Tests}
#Temperature
temp2015<-read.csv("2015 Temp.csv")
temp2015$Date<- mdy(temp2015$Date)
temp2015[,3][temp2015[,3]=='M']<- 0
temp2015<- temp2015 %>% filter(!(Date<'2015-07-04')) %>% filter(!(is.na(Date))) %>% rename(Temp= Mean.Hourly.Temp..F., Prec= Total.Precip..in.)
temp2015<- temp2015 %>% filter((Date<'2015-10-01'))
temp2015<- temp2015 %>% filter(!(Date=='2015-07-04'))
temp2015<- temp2015 %>% filter(!(Date=='2015-07-05'))
Temp5 <- t(temp2015[,"Temp",drop=FALSE])
Prec5<- t(temp2015[, "Prec", drop=FALSE])


cntl.list = list(maxit=5000, allow.degen=FALSE )
      dfa.model = list(A="zero", R="diagonal and unequal", m=3) 
      temp.dfa.MC2015=MARSS(MC.2015.t, model=dfa.model, control=cntl.list, covariates=Temp5, form="dfa",  z.score=TRUE, fit=TRUE) #259- Checking temp for MC 2015, its worse than discharge
      dfa.model = list(A="zero", R="diagonal and unequal", m=4)
      four.dfa.MC2015=MARSS(MC.2015.t, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) #132
     #Checking 4 trends lines for MC 2015, its the best
      dfa.model = list(A="zero", R="diagonal and unequal", m=5)
      five.dfa.MC2015=MARSS(MC.2015.t, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) #180.9
      #Checking 5 trendlines for MC 2015, it's worse than 4
  
      
    #Shifted Discharge  
      
      DischargeShift6<-Discharge6[1, 15:204]
      MC.2016.shift<-MC.2016[1:5, 1:190]
      dfa.shift2016=MARSS(MC.2016.shift, model=dfa.model, control=cntl.list, covariates=DischargeShift6, form="dfa",  z.score=TRUE, fit=TRUE) #843.6
      
      four.dfa.MC2016dis=MARSS(MC.2016, model=dfa.model, control=cntl.list, covariates= Discharge6, form="dfa",  z.score=TRUE, fit=TRUE)  #892
      
      four.dfa.MC2016$AICc #888
      
       DischargeShift2016 <- dataRetrieval::readNWISdv('05378500', '00060', startDate =  "2016-04-27", endDate = "2016-11-16")
       DischargeShift2016<-DischargeShift2016$X_00060_00003
       dfa.shift2016=MARSS(MC.2016, model=dfa.model, control=cntl.list, covariates=DischargeShift2016, form="dfa",  z.score=TRUE, fit=TRUE) #899
      
      
      
#Running it without CHL/BGA
      cntl.list = list(maxit=5000, allow.degen=FALSE )
      dfa.model = list(A="zero", R="diagonal and unequal", m=3) 
TFD2015MC=MARSS(MC.2015.ct[c(1,4,5),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
TFD2015MCDis=MARSS(MC.2015.ct[c(1,4,5),], model=dfa.model, control=cntl.list, covariates= Discharge5c, form="dfa",  z.score=TRUE, fit=TRUE)

TFD2016MC=MARSS(MC.2016.t[c(1,4,5),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
TFD2016MCDis=MARSS(MC.2016.t[c(1,4,5),], model=dfa.model, control=cntl.list, covariates= Discharge6, form="dfa",  z.score=TRUE, fit=TRUE)

TFD2017MC=MARSS(MC.2017.t[c(1,4,5),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
TFD2017MCDis=MARSS(MC.2017.t[c(1,4,5),], model=dfa.model, control=cntl.list, covariates= Discharge7, form="dfa",  z.score=TRUE, fit=TRUE)

TFD2018MC=MARSS(MC.2018.t[c(1,4,5),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
TFD2018MCDis=MARSS(MC.2018.t[c(1,4,5),], model=dfa.model, control=cntl.list, covariates= Discharge8, form="dfa",  z.score=TRUE, fit=TRUE)

#Running it with only BGA/CHL
cntl.list = list(maxit=5000, allow.degen=FALSE )
      dfa.model = list(A="zero", R="diagonal and unequal", m=1) 
BC2015MC=MARSS(MC.2015.ct[c(2,3),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
BC2015MCDis=MARSS(MC.2015.ct[c(2,3),], model=dfa.model, control=cntl.list, covariates= Discharge5c, form="dfa",  z.score=TRUE, fit=TRUE)

BC2016MC=MARSS(MC.2016.t[c(2,3),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
BC2016MCDis=MARSS(MC.2016.t[c(2,3),], model=dfa.model, control=cntl.list, covariates= Discharge6, form="dfa",  z.score=TRUE, fit=TRUE)

BC2017MC=MARSS(MC.2017.t[c(2,3),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
BC2017MCDis=MARSS(MC.2017.t[c(2,3),], model=dfa.model, control=cntl.list, covariates= Discharge7, form="dfa",  z.score=TRUE, fit=TRUE)

BC2018MC=MARSS(MC.2018.t[c(2,3),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
BC2018MCDis=MARSS(MC.2018.t[c(2,3),], model=dfa.model, control=cntl.list, covariates= Discharge8, form="dfa",  z.score=TRUE, fit=TRUE)

#Running it with BGA/CHL/Turb
cntl.list = list(maxit=5000, allow.degen=FALSE )
      dfa.model = list(A="zero", R="diagonal and unequal", m=2) 
BCT2015MC=MARSS(MC.2015.ct[c(1,2,3),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
BCT2015MCDis=MARSS(MC.2015.ct[c(1,2,3),], model=dfa.model, control=cntl.list, covariates= Discharge5c, form="dfa",  z.score=TRUE, fit=TRUE)

BCT2016MC=MARSS(MC.2016.t[c(1,2,3),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
BCT2016MCDis=MARSS(MC.2016.t[c(1,2,3),], model=dfa.model, control=cntl.list, covariates= Discharge6, form="dfa",  z.score=TRUE, fit=TRUE)

BCT2017MC=MARSS(MC.2017.t[c(1,2,3),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
BCT2017MCDis=MARSS(MC.2017.t[c(1,2,3),], model=dfa.model, control=cntl.list, covariates= Discharge7, form="dfa",  z.score=TRUE, fit=TRUE)

BCT2018MC=MARSS(MC.2018.t[c(1,2,3),], model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
BCT2018MCDis=MARSS(MC.2018.t[c(1,2,3),], model=dfa.model, control=cntl.list, covariates= Discharge8, form="dfa",  z.score=TRUE, fit=TRUE)

```


Running DFA for 4 trend lines. A covariate is tested with the SI 2018 data. Diagonal and unequal is used since this has previously shown to be better
```{r 4 Trends}
#Running DFA for 4 trends
cntl.list = list(maxit=5000, allow.degen=FALSE )
      dfa.model = list(A="zero", R="diagonal and unequal", m=4)
      four.dfa.MC2015=MARSS(MC.2015c, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE)
  
      four.dfa.MC2016=MARSS(MC.2016, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) #132
     
      four.dfa.MC2017=MARSS(MC.2017, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) 
      
      four.dfa.MC2018=MARSS(MC.2018, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) 
      
      four.dfa.SI2015=MARSS(SI.2015c, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) 
      
      four.dfa.SI2016=MARSS(SI.2016, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) 
      
      four.dfa.SI2018=MARSS(SI.2018c, model=dfa.model, control=cntl.list, form="dfa",  z.score=TRUE, fit=TRUE) 
      
      four.dfa.SI2018dis=MARSS(SI.2018c, model=dfa.model, control=cntl.list, covariates= Discharge8cs, form="dfa",  z.score=TRUE, fit=TRUE) 
      
```

Find the r squared value for the 3 trendlines. rqs(s)(#) is a matrix of the r squared for each variable and trendline, ie how well does each trendline predict each individual variable. rqs(s)(#)f is a matrix of the r squared for each variable and fit, ie how well does each fir found from the combination of the trendlines predict each individual variable. THe s is added for backwater and the # is the year (5-8). Save these and plot them


```{r R^2 for 3 trend lines}
#MC 2015
mod5= MC2015.modobj.nocov$'diagonal and unequal'$m3
mod_fit5 <- get_DFA_fits(mod5, alpha= .05)
trends.rot5t<- t(trends.rot5)

#Transposing not necessary
R251t = rsquare(trends.rot5t[,1], data = MC.2015r[,1])
df51t<- data.frame(trends.rot5t[,1], MC.2015[,1])

#R sq function
rsq <- function (x, y) cor(x, y) ^ 2

#Pull each dfa, save the fit lines
mod5= MC2015.modobj.nocov$'diagonal and unequal'$m3
mod_fit5 <- get_DFA_fits(mod5, alpha= .05)
mod6= MC2016.modobj.nocov$'diagonal and unequal'$m3
mod_fit6 <- get_DFA_fits(mod6, alpha= .05)
mod7= MC2017.modobj.nocov$'diagonal and unequal'$m3
mod_fit7 <- get_DFA_fits(mod7, alpha= .05)
mod8= MC2018.modobj.nocov$'diagonal and unequal'$m3
mod_fit8 <- get_DFA_fits(mod8, alpha= .05)

mods5= SI2015.modobj.nocov$'diagonal and unequal'$m3
mod_fits5 <- get_DFA_fits(mods5, alpha= .05)
mods6= SI2016.modobj.nocov$'diagonal and unequal'$m3
mod_fits6 <- get_DFA_fits(mods6, alpha= .05)
mods8= SI2018.modobj.nocov$'diagonal and unequal'$m3
mod_fits8 <- get_DFA_fits(mods8, alpha= .05)

#rqs(s)# : r^2 for each variable and trend line
#rsq#(s)f: r^2 for each fit and variable
#MC 2015
rsq5<- data.frame(c())
for(i in 1:5){
  for (j in 1:3){
    rsq5[i,j]<- rsq(trends.rot5t[,j],MC.2015[i,])
  }
}
rownames(rsq5)<- spp

rsq5f<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq5f[i,j]<- rsq(mod_fit5$ex[j,],MC.2015[i,])
  }
}
rownames(rsq5f)<- spp
colnames(rsq5f)<- paste(spp, "ex", sep="")


#MC 2016
rsq6<- data.frame(c())
for(i in 1:5){
  for (j in 1:3){
    rsq6[i,j]<- rsq(trends.rot6[j,],MC.2016[i,])
  }
}
rownames(rsq6)<- spp

rsq6f<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq6f[i,j]<- rsq(mod_fit6$ex[j,],MC.2016[i,])
  }
}
rownames(rsq6f)<- spp
colnames(rsq6f)<- paste(spp, "ex", sep="")

#MC 2017
rsq7<- data.frame(c())
for(i in 1:5){
  for (j in 1:3){
    rsq7[i,j]<- rsq(trends.rot7[j,],MC.2017[i,])
  }
}
rownames(rsq7)<- spp

rsq7f<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq7f[i,j]<- rsq(mod_fit7$ex[j,],MC.2017[i,])
  }
}
rownames(rsq7f)<- spp
colnames(rsq7f)<- paste(spp, "ex", sep="")

#MC 2018
rsq8<- data.frame(c())
for(i in 1:5){
  for (j in 1:3){
    rsq8[i,j]<- rsq(trends.rot8[j,],MC.2018[i,])
  }
}
rownames(rsq8)<- spp

rsq8f<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq8f[i,j]<- rsq(mod_fit8$ex[j,],MC.2018[i,])
  }
}
rownames(rsq8f)<- spp
colnames(rsq8f)<- paste(spp, "ex", sep="")


#SI 2015
rsq5s<- data.frame(c())
for(i in 1:5){
  for (j in 1:3){
    rsq5s[i,j]<- rsq(trends.rots5[j,],SI.2015[i,])
  }
}
rownames(rsq5s)<- spp

rsq5sf<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq5sf[i,j]<- rsq(mod_fits5$ex[j,],SI.2015[i,])
  }
}
rownames(rsq5sf)<- spp
colnames(rsq5sf)<- paste(spp, "ex", sep="")

#SI 2016
rsq6s<- data.frame(c())
for(i in 1:5){
  for (j in 1:3){
    rsq6s[i,j]<- rsq(trends.rots6[j,],SI.2016[i,])
  }
}
rownames(rsq6s)<- spp

rsq6sf<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq6sf[i,j]<- rsq(mod_fits6$ex[j,],SI.2016[i,])
  }
}
rownames(rsq6sf)<- spp
colnames(rsq6sf)<- paste(spp, "ex", sep="")


#SI 2018
rsq8s<- data.frame(c())
for(i in 1:5){
  for (j in 1:3){
    rsq8s[i,j]<- rsq(trends.rots8[j,],SI.2018[i,])
  }
}
rownames(rsq8s)<- spp

rsq8sf<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq8sf[i,j]<- rsq(mod_fits8$ex[j,],SI.2018[i,])
  }
}
rownames(rsq8sf)<- spp
colnames(rsq8sf)<- paste(spp, "ex", sep="")

#Saving the trend line/variable r^2 values
Rsquared<- rbind(as.data.frame(t(rsq5))  %>% mutate(Type= c("MC2015")), 
                   as.data.frame(t(rsq6))  %>% mutate(Type= c("MC2016")),
                   as.data.frame(t(rsq7))  %>% mutate(Type= c("MC2017")),
                   as.data.frame(t(rsq8))  %>% mutate(Type= c("MC2018")),
                   as.data.frame(t(rsq5s))  %>% mutate(Type= c("SI2015")), 
                   as.data.frame(t(rsq6s))  %>% mutate(Type= c("SI2016")),
                   as.data.frame(t(rsq8s))  %>% mutate(Type= c("SI2018")))
Rsquared<- Rsquared%>% mutate(Trend= c('V1'))
Rsquared[,'Trend']<- c('V1', 'V2', 'V3')
#Which trend lines most accurately predict which variables
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=Turb, fill=Trend), position='dodge')
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=CHLugL, fill=Trend), position='dodge')
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=BGAugL, fill=Trend), position='dodge')
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=FDOMqsu, fill=Trend), position='dodge')
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=NO3_mgL, fill=Trend), position='dodge')

#Which fits most accurately predict which variable
Rsquaredf<- rbind(as.data.frame(t(rsq5f))  %>% mutate(Type= c("MC2015")), 
                   as.data.frame(t(rsq6f))  %>% mutate(Type= c("MC2016")),
                   as.data.frame(t(rsq7f))  %>% mutate(Type= c("MC2017")),
                   as.data.frame(t(rsq8f))  %>% mutate(Type= c("MC2018")),
                   as.data.frame(t(rsq5sf))  %>% mutate(Type= c("SI2015")), 
                   as.data.frame(t(rsq6sf))  %>% mutate(Type= c("SI2016")),
                   as.data.frame(t(rsq8sf))  %>% mutate(Type= c("SI2018")))
Rsquaredf<-Rsquaredf %>% mutate (Ex= NA)
Rsquaredf[,'Ex']<- paste(spp,"ex", sep="")

ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=Turb, fill=Ex), position='dodge')
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=BGAugL, fill=Ex), position='dodge')
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=CHLugL, fill=Ex), position='dodge')
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=FDOMqsu, fill=Ex), position='dodge')
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=NO3_mgL, fill=Ex), position='dodge')

#Overall r^2 value for all of the data
rsq2015obs<- c(MC.2015[1,], MC.2015[2,], MC.2015[3,], MC.2015[4,], MC.2015[5,])
rsq2015exp<- c(mod_fit5$ex[1,], mod_fit5$ex[2,], mod_fit5$ex[3,], mod_fit5$ex[4,], mod_fit5$ex[5,])
rsq2015<- rsq(rsq2015obs,rsq2015exp)
rsq2015

rsq2016obs<- c(MC.2016[1,], MC.2016[2,], MC.2016[3,], MC.2016[4,], MC.2016[5,])
rsq2016exp<- c(mod_fit6$ex[1,], mod_fit6$ex[2,], mod_fit6$ex[3,], mod_fit6$ex[4,], mod_fit6$ex[5,])
rsq2016<- rsq(rsq2016obs,rsq2016exp)
rsq2016

rsq2017obs<- c(MC.2017[1,], MC.2017[2,], MC.2017[3,], MC.2017[4,], MC.2017[5,])
rsq2017exp<- c(mod_fit7$ex[1,], mod_fit7$ex[2,], mod_fit7$ex[3,], mod_fit7$ex[4,], mod_fit7$ex[5,])
rsq2017<- rsq(rsq2017obs,rsq2017exp)
rsq2017

rsq2018obs<- c(MC.2018[1,], MC.2018[2,], MC.2018[3,], MC.2018[4,], MC.2018[5,])
rsq2018exp<- c(mod_fit8$ex[1,], mod_fit8$ex[2,], mod_fit8$ex[3,], mod_fit8$ex[4,], mod_fit8$ex[5,])
rsq2018<- rsq(rsq2018obs,rsq2018exp)
rsq2018

rsq2018Sobs<- c(SI.2018[1,], SI.2018[2,], SI.2018[3,], SI.2018[4,], SI.2018[5,])
rsq2018Sexp<- c(mod_fits8$ex[1,], mod_fits8$ex[2,], mod_fits8$ex[3,], mod_fits8$ex[4,], mod_fits8$ex[5,])
rsq2018S<- rsq(rsq2018Sobs,rsq2018Sexp)
rsq2018S

rsq2016Sobs<- c(SI.2016[1,], SI.2016[2,], SI.2016[3,], SI.2016[4,], SI.2016[5,])
rsq2016Sexp<- c(mod_fits6$ex[1,], mod_fits6$ex[2,], mod_fits6$ex[3,], mod_fits6$ex[4,], mod_fits6$ex[5,])
rsq2016S<- rsq(rsq2016Sobs,rsq2016Sexp)
rsq2016S

rsq2015Sobs<- c(SI.2015[1,], SI.2015[2,], SI.2015[3,], SI.2015[4,], SI.2015[5,])
rsq2015Sexp<- c(mod_fits5$ex[1,], mod_fits5$ex[2,], mod_fits5$ex[3,], mod_fits5$ex[4,], mod_fits5$ex[5,])
rsq2015S<- rsq(rsq2015Sobs,rsq2015Sexp)
rsq2015S
```

Going through to get the r^2 value between the fits and the variables for just those specifically turb/turb, chl/chl (how well does the chl fit predict the chl data, ignores those such as how well does the bga fit line predict the chl data, which is inlcuded in the above matrix). Combine into sqall and plot

```{r R^2 3 trendlines more specifics}
#Saving the r^2 for turb/turb, chl/chl, etc
pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq5f[i,i])
}
rsqall2015<- data.frame('r^2'= c(pp, rsq2015), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq6f[i,i])
}
rsqall2016<- data.frame('r^2'= c(pp, rsq2016), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq7f[i,i])
}
rsqall2017<- data.frame('r^2'= c(pp, rsq2017), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq8f[i,i])
}
rsqall2018<- data.frame('r^2'= c(pp, rsq2018), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq5sf[i,i])
}
rsqall2015s<- data.frame('r^2'= c(pp, rsq2015S), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq6sf[i,i])
}
rsqall2016s<- data.frame('r^2'= c(pp, rsq2016S), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq8sf[i,i])
}
rsqall2018s<- data.frame('r^2'= c(pp, rsq2018S), 'Variable'= c(spp, 'Overall'))

sqall<- rbind(rsqall2015  %>% mutate(Type= c("MC2015")), 
                   rsqall2016  %>% mutate(Type= c("MC2016")),
                   rsqall2017  %>% mutate(Type= c("MC2017")),
                   rsqall2018  %>% mutate(Type= c("MC2018")),
                   rsqall2015s  %>% mutate(Type= c("SI2015")), 
                   rsqall2016s  %>% mutate(Type= c("SI2016")),
                   rsqall2018s  %>% mutate(Type= c("SI2018")))
YearsAreas<- c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018", "Backwater 2015", "Backwater 2016", "Backwater 2018")
names(YearsAreas)<- c("MC2015", "MC2016", "MC2017", "MC2018", "SI2015", "SI2016", "SI2018")
ggplot(data=sqall) + geom_bar(stat= 'identity',mapping=aes(x=Variable, y=r.2)) + labs(title= "R squared Values for Dynamic Factor Analysis Predictions", x="Water Quality Variable", y= "r squared") + scale_x_discrete(labels= c("Turb", "Chl-a", "BGA", "FDOM", "N03", "Overall"))  + facet_wrap(.~Type, labeller= labeller( Type=YearsAreas), ncol=4)

mean(c(rsq2015, rsq2016, rsq2017, rsq2018, rsq2015S, rsq2016S, rsq2018S))
```

The same process as above but for 4 trendlines. First, find the fits

```{r R^2 4 trends}
#MC 2015
mod5= four.dfa.MC2015
mod_fit5 <- get_DFA_fits(mod5, alpha= .05)
trends.rot5t<- t(trends.rot5)

#Transposing not necessary
#R251t = rsquare(trends.rot5t[,1], data = MC.2015r[,1])
#df51t<- data.frame(trends.rot5t[,1], MC.2015[,1])

#R sq function
rsq <- function (x, y) cor(x, y) ^ 2

mod5= four.dfa.MC2015
mod_fit5 <- get_DFA_fits(mod5, alpha= .05)
mod6= four.dfa.MC2016
mod_fit6 <- get_DFA_fits(mod6, alpha= .05)
mod7= four.dfa.MC2017
mod_fit7 <- get_DFA_fits(mod7, alpha= .05)
mod8= four.dfa.MC2018
mod_fit8 <- get_DFA_fits(mod8, alpha= .05)

mods5= four.dfa.SI2015
mod_fits5 <- get_DFA_fits(mods5, alpha= .05)
mods6= four.dfa.SI2016
mod_fits6 <- get_DFA_fits(mods6, alpha= .05)
mods8= four.dfa.SI2018
mod_fits8 <- get_DFA_fits(mods8, alpha= .05)

#rqs(s)# : r^2 for each variable and trend line
#rsq#(s)f: r^2 for each fit and variable

#MC 2015
rsq5<- data.frame(c())
for(i in 1:5){
  for (j in 1:4){
    rsq5[i,j]<- rsq(trends.rot45[j,],MC.2015.ct[i,])
  }
}
rownames(rsq5)<- spp

rsq5f<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq5f[i,j]<- rsq(mod_fit5$ex[j,],MC.2015.ct[i,])
  }
}
rownames(rsq5f)<- spp
colnames(rsq5f)<- paste(spp, "ex", sep="")


#MC 2016
rsq6<- data.frame(c())
for(i in 1:5){
  for (j in 1:4){
    rsq6[i,j]<- rsq(trends.rot46[j,],MC.2016[i,])
  }
}
rownames(rsq6)<- spp

rsq6f<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq6f[i,j]<- rsq(mod_fit6$ex[j,],MC.2016[i,])
  }
}
rownames(rsq6f)<- spp
colnames(rsq6f)<- paste(spp, "ex", sep="")

#MC 2017
rsq7<- data.frame(c())
for(i in 1:5){
  for (j in 1:4){
    rsq7[i,j]<- rsq(trends.rot47[j,],MC.2017[i,])
  }
}
rownames(rsq7)<- spp

rsq7f<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq7f[i,j]<- rsq(mod_fit7$ex[j,],MC.2017[i,])
  }
}
rownames(rsq7f)<- spp
colnames(rsq7f)<- paste(spp, "ex", sep="")

#MC 2018
rsq8<- data.frame(c())
for(i in 1:5){
  for (j in 1:4){
    rsq8[i,j]<- rsq(trends.rot48[j,],MC.2018[i,])
  }
}
rownames(rsq8)<- spp

rsq8f<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq8f[i,j]<- rsq(mod_fit8$ex[j,],MC.2018[i,])
  }
}
rownames(rsq8f)<- spp
colnames(rsq8f)<- paste(spp, "ex", sep="")


#SI 2015
rsq5s<- data.frame(c())
for(i in 1:5){
  for (j in 1:4){
    rsq5s[i,j]<- rsq(trends.rots45[j,],SI.2015.ct[i,])
  }
}
rownames(rsq5s)<- spp

rsq5sf<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq5sf[i,j]<- rsq(mod_fits5$ex[j,],SI.2015.ct[i,])
  }
}
rownames(rsq5sf)<- spp
colnames(rsq5sf)<- paste(spp, "ex", sep="")

#SI 2016
rsq6s<- data.frame(c())
for(i in 1:5){
  for (j in 1:4){
    rsq6s[i,j]<- rsq(trends.rots46[j,],SI.2016[i,])
  }
}
rownames(rsq6s)<- spp

rsq6sf<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq6sf[i,j]<- rsq(mod_fits6$ex[j,],SI.2016[i,])
  }
}
rownames(rsq6sf)<- spp
colnames(rsq6sf)<- paste(spp, "ex", sep="")


#SI 2018
rsq8s<- data.frame(c())
for(i in 1:5){
  for (j in 1:4){
    rsq8s[i,j]<- rsq(trends.rots48[j,],SI.2018.ct[i,])
  }
}
rownames(rsq8s)<- spp

rsq8sf<- data.frame(c())
for(i in 1:5){
  for(j in 1:5){
    rsq8sf[i,j]<- rsq(mod_fits8$ex[j,],SI.2018.ct[i,])
  }
}
rownames(rsq8sf)<- spp
colnames(rsq8sf)<- paste(spp, "ex", sep="")

#rqs(s)# : r^2 for each variable and trend line
#rsq#(s)f: r^2 for each fit and variable

Rsquared<- rbind(as.data.frame(t(rsq5))  %>% mutate(Type= c("MC2015")), 
                   as.data.frame(t(rsq6))  %>% mutate(Type= c("MC2016")),
                   as.data.frame(t(rsq7))  %>% mutate(Type= c("MC2017")),
                   as.data.frame(t(rsq8))  %>% mutate(Type= c("MC2018")),
                   as.data.frame(t(rsq5s))  %>% mutate(Type= c("SI2015")), 
                   as.data.frame(t(rsq6s))  %>% mutate(Type= c("SI2016")),
                   as.data.frame(t(rsq8s))  %>% mutate(Type= c("SI2018")))
Rsquared<- Rsquared%>% mutate(Trend= c('V1'))
Rsquared[,'Trend']<- c('V1', 'V2', 'V3', 'V4')

#How well does each trend line predict variable
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=Turb, fill=Trend), position='dodge')
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=CHLugL, fill=Trend), position='dodge')
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=BGAugL, fill=Trend), position='dodge')
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=FDOMqsu, fill=Trend), position='dodge')
ggplot(data=Rsquared) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=NO3_mgL, fill=Trend), position='dodge')

Rsquaredf<- rbind(as.data.frame(t(rsq5f))  %>% mutate(Type= c("MC2015")), 
                   as.data.frame(t(rsq6f))  %>% mutate(Type= c("MC2016")),
                   as.data.frame(t(rsq7f))  %>% mutate(Type= c("MC2017")),
                   as.data.frame(t(rsq8f))  %>% mutate(Type= c("MC2018")),
                   as.data.frame(t(rsq5sf))  %>% mutate(Type= c("SI2015")), 
                   as.data.frame(t(rsq6sf))  %>% mutate(Type= c("SI2016")),
                   as.data.frame(t(rsq8sf))  %>% mutate(Type= c("SI2018")))
Rsquaredf<-Rsquaredf %>% mutate (Ex= NA)
Rsquaredf[,'Ex']<- paste(spp,"ex", sep="")

#How well does each fit predict each variable
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=Turb, fill=Ex), position='dodge')
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=BGAugL, fill=Ex), position='dodge')
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=CHLugL, fill=Ex), position='dodge')
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=FDOMqsu, fill=Ex), position='dodge')
ggplot(data=Rsquaredf) + geom_bar(stat= 'identity', mapping=aes(x=Type, y=NO3_mgL, fill=Ex), position='dodge')


#FInding the overall r^2 for all of the variables and predictions
rsq2015obs<- c(MC.2015c[1,], MC.2015c[2,], MC.2015c[3,], MC.2015c[4,], MC.2015c[5,])
rsq2015exp<- c(mod_fit5$ex[1,], mod_fit5$ex[2,], mod_fit5$ex[3,], mod_fit5$ex[4,], mod_fit5$ex[5,])
rsq2015<- rsq(rsq2015obs,rsq2015exp)
#rsq2015

rsq2016obs<- c(MC.2016[1,], MC.2016[2,], MC.2016[3,], MC.2016[4,], MC.2016[5,])
rsq2016exp<- c(mod_fit6$ex[1,], mod_fit6$ex[2,], mod_fit6$ex[3,], mod_fit6$ex[4,], mod_fit6$ex[5,])
rsq2016<- rsq(rsq2016obs,rsq2016exp)
#rsq2016

rsq2017obs<- c(MC.2017[1,], MC.2017[2,], MC.2017[3,], MC.2017[4,], MC.2017[5,])
rsq2017exp<- c(mod_fit7$ex[1,], mod_fit7$ex[2,], mod_fit7$ex[3,], mod_fit7$ex[4,], mod_fit7$ex[5,])
rsq2017<- rsq(rsq2017obs,rsq2017exp)
#rsq2017

rsq2018obs<- c(MC.2018[1,], MC.2018[2,], MC.2018[3,], MC.2018[4,], MC.2018[5,])
rsq2018exp<- c(mod_fit8$ex[1,], mod_fit8$ex[2,], mod_fit8$ex[3,], mod_fit8$ex[4,], mod_fit8$ex[5,])
rsq2018<- rsq(rsq2018obs,rsq2018exp)
#rsq2018

rsq2018Sobs<- c(SI.2018c[1,], SI.2018c[2,], SI.2018c[3,], SI.2018c[4,], SI.2018c[5,])
rsq2018Sexp<- c(mod_fits8$ex[1,], mod_fits8$ex[2,], mod_fits8$ex[3,], mod_fits8$ex[4,], mod_fits8$ex[5,])
rsq2018S<- rsq(rsq2018Sobs,rsq2018Sexp)
#rsq2018S

rsq2016Sobs<- c(SI.2016[1,], SI.2016[2,], SI.2016[3,], SI.2016[4,], SI.2016[5,])
rsq2016Sexp<- c(mod_fits6$ex[1,], mod_fits6$ex[2,], mod_fits6$ex[3,], mod_fits6$ex[4,], mod_fits6$ex[5,])
rsq2016S<- rsq(rsq2016Sobs,rsq2016Sexp)
rsq2016S

rsq2015Sobs<- c(SI.2015c[1,], SI.2015c[2,], SI.2015c[3,], SI.2015c[4,], SI.2015c[5,])
rsq2015Sexp<- c(mod_fits5$ex[1,], mod_fits5$ex[2,], mod_fits5$ex[3,], mod_fits5$ex[4,], mod_fits5$ex[5,])
rsq2015S<- rsq(rsq2015Sobs,rsq2015Sexp)
#rsq2015S
```

```{r R^2 4 Trends more specifics}
#FInding the diagonals for rsq#(s)f
#How well does turb fit predict turb, chl fit predict chl
pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq5f[i,i])
}
rsqall2015<- data.frame('r^2'= c(pp, rsq2015), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq6f[i,i])
}
rsqall2016<- data.frame('r^2'= c(pp, rsq2016), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq7f[i,i])
}
rsqall2017<- data.frame('r^2'= c(pp, rsq2017), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq8f[i,i])
}
rsqall2018<- data.frame('r^2'= c(pp, rsq2018), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq5sf[i,i])
}
rsqall2015s<- data.frame('r^2'= c(pp, rsq2015S), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq6sf[i,i])
}
rsqall2016s<- data.frame('r^2'= c(pp, rsq2016S), 'Variable'= c(spp, 'Overall'))

pp<-c()
for(i in 1:5){
  pp<-c(pp, rsq8sf[i,i])
}
rsqall2018s<- data.frame('r^2'= c(pp, rsq2018S), 'Variable'= c(spp, 'Overall'))

#NOTE THESE ARE NOT IN ORDER: need to order them
sqall<- rbind(rsqall2015  %>% mutate(Type= c("MC2015")), 
                   rsqall2016  %>% mutate(Type= c("MC2016")),
                   rsqall2017  %>% mutate(Type= c("MC2017")),
                   rsqall2018  %>% mutate(Type= c("MC2018")),
                   rsqall2015s  %>% mutate(Type= c("SI2015")), 
                   rsqall2016s  %>% mutate(Type= c("SI2016")),
                   rsqall2018s  %>% mutate(Type= c("SI2018")))
YearsAreas<- c("Main Channel 2015", "Main Channel 2016", "Main Channel 2017", "Main Channel 2018", "Backwater 2015", "Backwater 2016", "Backwater 2018")
names(YearsAreas)<- c("MC2015", "MC2016", "MC2017", "MC2018", "SI2015", "SI2016", "SI2018")
ggplot(data=sqall) + geom_bar(stat= 'identity',mapping=aes(x=Variable, y=r.2)) + labs(title= "R squared Values for Dynamic Factor Analysis Predictions", x="Water Quality Variable", y= "r squared") +  facet_wrap(.~Type, labeller= labeller( Type=YearsAreas), ncol=4) #scale_x_discrete(labels= c("Turb", "Chl-a", "BGA", "FDOM", "N03", "Overall"))  +

#Mean of all of the r^2
mean(c(rsq2015, rsq2016, rsq2017, rsq2018, rsq2015S, rsq2016S, rsq2018S))
```

Raw data for seasonal plots, combined into AllData

```{r Data for Seasonal Plots}

#Stroing data with the dates, April 13 is day 1
MC.2015.rawc<-  MC.2015.rawc %>% filter(Date<'2015-10-01')
MC.2015.rawc<-  MC.2015.rawc %>% filter(!(Date=='2015-07-05'))
MC.2016.raw<- MC.2016.raw %>% select(!month) %>% select(!day)
MC.2017.raw<- MC.2017.raw %>% select(!month) %>% select(!day)
AllData<- rbind(MC.2015.rawc %>% mutate( num= c(85:171)) %>% mutate(Type= c("MC2015") ) %>% mutate(Area= c("MC")) %>% mutate(Year= c("2015")), 
                   MC.2016.raw %>% mutate( num= c(1:204)) %>% mutate(Type= c("MC2016"))%>% mutate(Area= c("MC"))%>% mutate(Year= c("2016")),
                   MC.2017.raw %>% mutate( num= c(58:177)) %>% mutate(Type= c("MC2017"))%>% mutate(Area= c("MC"))%>% mutate(Year= c("2017")),
                   MC.2018.raw %>% mutate( num= c(50:171)) %>% mutate(Type= c("MC2018"))%>% mutate(Area= c("MC"))%>% mutate(Year= c("2018")),
                   SI.2015.rawc %>% mutate( num= c(50:186)) %>% mutate(Type= c("SI2015"))%>% mutate(Area= c("SI"))%>% mutate(Year= c("2015")), 
                   SI.2016.raw%>% mutate( num= c(1:185)) %>% mutate(Type= c("SI2016"))%>% mutate(Area= c("SI"))%>% mutate(Year= c("2016")),
                   SI.2018.rawc%>% mutate( num= c(40:178)) %>% mutate(Type= c("SI2018"))%>% mutate(Area= c("SI"))%>% mutate(Year= c("2018")))

#write.csv(AllData, "AllData.csv")
```

Multiple graphs for each variable graphed over the years/locations

```{r Variable for Years}

#MAIN Channel Nitrate for each year
AllDataMC<-AllData %>% filter(Area=='MC')
plotNMC<-ggplot(data=AllDataMC) + geom_line(mapping=aes(x=num, y=NO3_mgL, color= Type), size=1) + 
  #facet_wrap(~Area)+ #, labeller= labeller( Type=YearsAreas)) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Nitrate (mgL)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
  theme(legend.position= "none") +
  #ggtitle("Nitrate Levels Each Year in the Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#MAIN Channel Turb for each year
plotTMC<-ggplot(data=AllDataMC) + geom_line(mapping=aes(x=num, y=Turb, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=3, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Turb (NTU)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
   theme(legend.position= "none") +
  #ggtitle("Turbidity Levels Each Year in the Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#MAIN Turb zoomed in
plotTZMC<-ggplot(data=AllDataMC) + geom_line(mapping=aes(x=num, y=Turb, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=3, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Turb (NTU)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
  ylim(NA,13)+
   theme(legend.position= "none") +
  #ggtitle("Turbidity Levels Each Year in the Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())


#MAIN Channel BGA for each year
plotBMC<-ggplot(data=AllDataMC) + geom_line(mapping=aes(x=num, y=BGAugL, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Blue-Green \n Algae (ugL)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
   theme(legend.position= "none") +
 # ggtitle("Blue-Green Algae Levels Each Year in the Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#MAIN Channel CHL for each year
plotCMC<-ggplot(data=AllDataMC) + geom_line(mapping=aes(x=num, y=CHLugL, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Chlorophyll-a (ugL)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
   theme(legend.position= "none") +
  #ggtitle("Chlorophyll-a Levels Each Year in the Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#MAIN Channel FDOM for each year
plotFMC<-ggplot(data=AllDataMC) + geom_line(mapping=aes(x=num, y=FDOMqsu, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=35, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "FDOM (qsu)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
  
  #ggtitle("FDOM Levels Each Year in the Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

plotDMC<-ggplot(data=AllDataMC) + geom_line(mapping=aes(x=num, y=Discharge, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=30000, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Discharge (cfu)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
  
  #ggtitle("Discharge Levels Each Year in the Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

grid.arrange(plotBMC,plotCMC, plotFMC, plotNMC,plotTZMC , plotDMC, nrow=2)
#Need to move dates, remove november


#BACK Nitrate each year
AllDataSI<-AllData %>% filter(Area=='SI')
ggplot(data=AllDataSI) + geom_line(mapping=aes(x=num, y=NO3_mgL, color= Type), size=1) + 
  #facet_wrap(~Area)+ #, labeller= labeller( Type=YearsAreas)) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Nitrate (mgL)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#009E73"), name= "Year", labels=c("2015", "2016", "2018")) +
  
  ggtitle("Nitrate Levels Each Year in the Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())


#BACK Turb each year
ggplot(data=AllDataSI) + geom_line(mapping=aes(x=num, y=Turb, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=0, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Turbidity (NTU)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#009E73"), name= "Year", labels=c("2015", "2016", "2018")) +
  
  ggtitle("Turbidity Levels Each Year in the Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#BACK Turb Zoomed in each year
ggplot(data=AllDataSI) + geom_line(mapping=aes(x=num, y=Turb, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=0, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Turbidity (NTU)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#009E73"), name= "Year", labels=c("2015", "2016", "2018")) +
  ylim(NA, 10) +
  ggtitle("Turbidity Levels Each Year in the Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#BACK BGA each year
ggplot(data=AllDataSI) + geom_line(mapping=aes(x=num, y=BGAugL, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Blue-Green Algae (ugL)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#009E73"), name= "Year", labels=c("2015", "2016", "2018")) +
  
  ggtitle("Blue-Green Algae Levels Each Year in the Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#BACK CHL each year
ggplot(data=AllDataSI) + geom_line(mapping=aes(x=num, y=CHLugL, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Chlorophyll-a (ugL)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#009E73"), name= "Year", labels=c("2015", "2016", "2018")) +
  ggtitle("Chlorophyll-a Levels Each Year in the Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

#BACK FDOM
ggplot(data=AllDataSI) + geom_line(mapping=aes(x=num, y=FDOMqsu, color= Type), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=30, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "FDOM (qsu)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#009E73"), name= "Year", labels=c("2015", "2016", "2018")) +
  ggtitle("FDOM Levels Each Year in the Backwater")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

```

Pairs of consituents graphed for each year and location. A function is created for each of the 10 pairs to see the pairing for each year and location

```{r Pairs Each Year}
AllDataMC5<-AllData %>% filter(Type=='MC2015')
AllDataMC6<-AllData %>% filter(Type=='MC2016')
AllDataMC7<-AllData %>% filter(Type=='MC2017')
AllDataMC8<-AllData %>% filter(Type=='MC2018')
AllDataSI5<-AllData %>% filter(Type=='SI2015')
AllDataSI7<-AllData %>% filter(Type=='SI2017')
AllDataSI8<-AllData %>% filter(Type=='SI2018')

PairGraphsBC<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=CHLugL), color=  "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=BGAugL*10), color= "#0072B2", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Chlorophyll-a",
    sec.axis = sec_axis(~./10, name="Blue-Green Algae (ugL)")
  ) + 
  ggtitle(paste("Chlorophyll-a and Blue-Green Algae in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color =  "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#0072B2", size=13)
  ) +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())+ 
    labs(x="Month")
}
#"#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"

PairGraphsBC(AllDataMC5, '2015', 'Main Channel')
PairGraphsBC(AllDataMC6, '2016', 'Main Channel')
PairGraphsBC(AllDataMC7, '2017', 'Main Channel')
PairGraphsBC(AllDataMC8, '2018', 'Main Channel')
PairGraphsBC(AllDataSI5, '2015', 'Backwater')
PairGraphsBC(AllDataSI6, '2016', 'Backwater')
PairGraphsBC(AllDataSI8, '2018', 'Backwater')



#Scale is 50 for BW, 10 for MC
PairGraphsBF<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=FDOMqsu), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=BGAugL*50+100), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=95, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "FDOM (qsu)",
    sec.axis = sec_axis(~(.-100)/50, name="Blue-Green Algae (ugL)")
  ) + 
  ggtitle(paste("FDOM and Blue-Green Algae in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsBF(AllDataMC5, '2015', 'Main Channel')
PairGraphsBF(AllDataMC6, '2016', 'Main Channel')
PairGraphsBF(AllDataMC7, '2017', 'Main Channel')
PairGraphsBF(AllDataMC8, '2018', 'Main Channel')
PairGraphsBF(AllDataSI5, '2015', 'Backwater')
PairGraphsBF(AllDataSI6, '2016', 'Backwater')
PairGraphsBF(AllDataSI8, '2018', 'Backwater')

PairGraphsBN<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=NO3_mgL), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=BGAugL), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Nitrate (qsu)",
    sec.axis = sec_axis(~., name="Blue-Green Algae (ugL)")
  ) + 
  ggtitle(paste("Nitrate and Blue-Green Algae in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsBN(AllDataMC5, '2015', 'Main Channel')
PairGraphsBN(AllDataMC6, '2016', 'Main Channel')
PairGraphsBN(AllDataMC7, '2017', 'Main Channel')
PairGraphsBN(AllDataMC8, '2018', 'Main Channel')
PairGraphsBN(AllDataSI5, '2015', 'Backwater')
PairGraphsBN(AllDataSI6, '2016', 'Backwater')
PairGraphsBN(AllDataSI8, '2018', 'Backwater')

PairGraphsBT<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=Turb), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=BGAugL+5), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Turbidity (NTU)",
    sec.axis = sec_axis(~.-5, name="Blue-Green Algae (ugL)")
  ) + 
    ylim(NA, 15)+
  ggtitle(paste("Turbidity and Blue-Green Algae in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsBT(AllDataMC5, '2015', 'Main Channel')
PairGraphsBT(AllDataMC6, '2016', 'Main Channel')
PairGraphsBT(AllDataMC7, '2017', 'Main Channel')
PairGraphsBT(AllDataMC8, '2018', 'Main Channel')
PairGraphsBT(AllDataSI5, '2015', 'Backwater')
PairGraphsBT(AllDataSI6, '2016', 'Backwater')
PairGraphsBT(AllDataSI8, '2018', 'Backwater')


PairGraphsCF<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=CHLugL), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(FDOMqsu-100)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Chlorophyll (ugL)",
    sec.axis = sec_axis(~.+100, name="FDOM (qsu)")
  ) + 
    
  ggtitle(paste("FDOM and Chlorophyll-a in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsCF(AllDataMC5, '2015', 'Main Channel')
PairGraphsCF(AllDataMC6, '2016', 'Main Channel')
PairGraphsCF(AllDataMC7, '2017', 'Main Channel')
PairGraphsCF(AllDataMC8, '2018', 'Main Channel')
PairGraphsCF(AllDataSI5, '2015', 'Backwater')
PairGraphsCF(AllDataSI6, '2016', 'Backwater')
PairGraphsCF(AllDataSI8, '2018', 'Backwater')


PairGraphsCN<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=CHLugL), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(NO3_mgL*10)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Chlorophyll-a (ugL)",
    sec.axis = sec_axis(~./10, name="Nitrate (mgL)")
  ) + 
    
  ggtitle(paste("Chlorophyll-a and Nitrate in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsCN(AllDataMC5, '2015', 'Main Channel')
PairGraphsCN(AllDataMC6, '2016', 'Main Channel')
PairGraphsCN(AllDataMC7, '2017', 'Main Channel')
PairGraphsCN(AllDataMC8, '2018', 'Main Channel')
PairGraphsCN(AllDataSI5, '2015', 'Backwater')
PairGraphsCN(AllDataSI6, '2016', 'Backwater')
PairGraphsCN(AllDataSI8, '2018', 'Backwater')


PairGraphsCT<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=CHLugL), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(Turb*4)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Chlorophyll-a (ugL)",
    sec.axis = sec_axis(~./4, name="Turbidity (NTU)")
  ) + 
    #ylim(NA,100)+ #For BW 2018
  ggtitle(paste("Chlorophyll-a and Turbidty in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsCT(AllDataMC5, '2015', 'Main Channel')
PairGraphsCT(AllDataMC6, '2016', 'Main Channel')
PairGraphsCT(AllDataMC7, '2017', 'Main Channel')
PairGraphsCT(AllDataMC8, '2018', 'Main Channel')
PairGraphsCT(AllDataSI5, '2015', 'Backwater')
PairGraphsCT(AllDataSI6, '2016', 'Backwater')
PairGraphsCT(AllDataSI8, '2018', 'Backwater')


PairGraphsFN<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=FDOMqsu), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=((NO3_mgL*5)+100)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=100, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "FDOM (qsu)",
    sec.axis = sec_axis(~(.-100)/5, name="Nitrate (mgL)")
  ) + 
    
  ggtitle(paste("FDOM and Nitrate in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsFN(AllDataMC5, '2015', 'Main Channel')
PairGraphsFN(AllDataMC6, '2016', 'Main Channel')
PairGraphsFN(AllDataMC7, '2017', 'Main Channel')
PairGraphsFN(AllDataMC8, '2018', 'Main Channel')
PairGraphsFN(AllDataSI5, '2015', 'Backwater')
PairGraphsFN(AllDataSI6, '2016', 'Backwater')
PairGraphsFN(AllDataSI8, '2018', 'Backwater')


PairGraphsFT<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=FDOMqsu), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(Turb*10)+20), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=100, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "FDOM (qsu)",
    sec.axis = sec_axis(~(.-20)/10, name="Turbidity (NTU)")
  ) + 
    #ylim(NA, 250)+ #For BW 2018
  ggtitle(paste("FDOM and Turbidity in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsFT(AllDataMC5, '2015', 'Main Channel')
PairGraphsFT(AllDataMC6, '2016', 'Main Channel')
PairGraphsFT(AllDataMC7, '2017', 'Main Channel')
PairGraphsFT(AllDataMC8, '2018', 'Main Channel')
PairGraphsFT(AllDataSI5, '2015', 'Backwater')
PairGraphsFT(AllDataSI6, '2016', 'Backwater')
PairGraphsFT(AllDataSI8, '2018', 'Backwater')


PairGraphsNT<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=NO3_mgL), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(Turb/4)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=0, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Nitrate (mgL)",
    sec.axis = sec_axis(~./4, name="Turbidity (NTU)")
  ) + 
  
  ggtitle(paste("Nitrate and Turbidity in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsNT(AllDataMC5, '2015', 'Main Channel')
PairGraphsNT(AllDataMC6, '2016', 'Main Channel')
PairGraphsNT(AllDataMC7, '2017', 'Main Channel')
PairGraphsNT(AllDataMC8, '2018', 'Main Channel')
PairGraphsNT(AllDataSI5, '2015', 'Backwater')
PairGraphsNT(AllDataSI6, '2016', 'Backwater')
PairGraphsNT(AllDataSI8, '2018', 'Backwater')
```

Finding the correlations between each pairing for each year and locations
```{r Pairs correlations}
#Blue-green algae, Chl
cor(AllDataMC5$CHLugL, AllDataMC5$BGAugL)
cor(AllDataMC6$CHLugL, AllDataMC6$BGAugL)
cor(AllDataMC7$CHLugL, AllDataMC7$BGAugL)
cor(AllDataMC8$CHLugL, AllDataMC8$BGAugL)
cor(AllDataSI5$CHLugL, AllDataSI5$BGAugL)
cor(AllDataSI6$CHLugL, AllDataSI6$BGAugL)
cor(AllDataSI8$CHLugL, AllDataSI8$BGAugL)

#Blue-green algae, FDOM
cor(AllDataMC5$FDOMqsu, AllDataMC5$BGAugL)
cor(AllDataMC6$FDOMqsu, AllDataMC6$BGAugL)
cor(AllDataMC7$FDOMqsu, AllDataMC7$BGAugL)
cor(AllDataMC8$FDOMqsu, AllDataMC8$BGAugL)
cor(AllDataSI5$FDOMqsu, AllDataSI5$BGAugL)
cor(AllDataSI6$FDOMqsu, AllDataSI6$BGAugL)
cor(AllDataSI8$FDOMqsu, AllDataSI8$BGAugL)

#Blue-green algae, nitrate
cor(AllDataMC5$NO3_mgL, AllDataMC5$BGAugL)
cor(AllDataMC6$NO3_mgL, AllDataMC6$BGAugL)
cor(AllDataMC7$NO3_mgL, AllDataMC7$BGAugL)
cor(AllDataMC8$NO3_mgL, AllDataMC8$BGAugL)
cor(AllDataSI5$NO3_mgL, AllDataSI5$BGAugL)
cor(AllDataSI6$NO3_mgL, AllDataSI6$BGAugL)
cor(AllDataSI8$NO3_mgL, AllDataSI8$BGAugL)

#Blue-green algae, turbidity
cor(AllDataMC5$Turb, AllDataMC5$BGAugL)
cor(AllDataMC6$Turb, AllDataMC6$BGAugL)
cor(AllDataMC7$Turb, AllDataMC7$BGAugL)
cor(AllDataMC8$Turb, AllDataMC8$BGAugL)
cor(AllDataSI5$Turb, AllDataSI5$BGAugL)
cor(AllDataSI6$Turb, AllDataSI6$BGAugL)
cor(AllDataSI8$Turb, AllDataSI8$BGAugL)

#Blue-green algae, discharge
cor(AllDataMC5$Discharge, AllDataMC5$BGAugL)
cor(AllDataMC6$Discharge, AllDataMC6$BGAugL)
cor(AllDataMC7$Discharge, AllDataMC7$BGAugL)
cor(AllDataMC8$Discharge, AllDataMC8$BGAugL)
cor(AllDataSI5$Discharge, AllDataSI5$BGAugL)
cor(AllDataSI6$Discharge, AllDataSI6$BGAugL)
cor(AllDataSI8$Discharge, AllDataSI8$BGAugL)

#CHL, FDOM
cor(AllDataMC5$CHLugL, AllDataMC5$FDOMqsu)
cor(AllDataMC6$CHLugL, AllDataMC6$FDOMqsu)
cor(AllDataMC7$CHLugL, AllDataMC7$FDOMqsu)
cor(AllDataMC8$CHLugL, AllDataMC8$FDOMqsu)
cor(AllDataSI5$CHLugL, AllDataSI5$FDOMqsu)
cor(AllDataSI6$CHLugL, AllDataSI6$FDOMqsu)
cor(AllDataSI8$CHLugL, AllDataSI8$FDOMqsu)

#CHL, Nitrate
cor(AllDataMC5$CHLugL, AllDataMC5$NO3_mgL)
cor(AllDataMC6$CHLugL, AllDataMC6$NO3_mgL)
cor(AllDataMC7$CHLugL, AllDataMC7$NO3_mgL)
cor(AllDataMC8$CHLugL, AllDataMC8$NO3_mgL)
cor(AllDataSI5$CHLugL, AllDataSI5$NO3_mgL)
cor(AllDataSI6$CHLugL, AllDataSI6$NO3_mgL)
cor(AllDataSI8$CHLugL, AllDataSI8$NO3_mgL)

#CHL, Turb
cor(AllDataMC5$CHLugL, AllDataMC5$Turb)
cor(AllDataMC6$CHLugL, AllDataMC6$Turb)
cor(AllDataMC7$CHLugL, AllDataMC7$Turb)
cor(AllDataMC8$CHLugL, AllDataMC8$Turb)
cor(AllDataSI5$CHLugL, AllDataSI5$Turb)
cor(AllDataSI6$CHLugL, AllDataSI6$Turb)
cor(AllDataSI8$CHLugL, AllDataSI8$Turb)

#CHL, Discharge
cor(AllDataMC5$CHLugL, AllDataMC5$Discharge)
cor(AllDataMC6$CHLugL, AllDataMC6$Discharge)
cor(AllDataMC7$CHLugL, AllDataMC7$Discharge)
cor(AllDataMC8$CHLugL, AllDataMC8$Discharge)
cor(AllDataSI5$CHLugL, AllDataSI5$Discharge)
cor(AllDataSI6$CHLugL, AllDataSI6$Discharge)
cor(AllDataSI8$CHLugL, AllDataSI8$Discharge)

#FDOM, Nitrate


#FDOM, turb

#FDOM, Discharge

#Nitrate, turb

#Nitrate, discharge

#Turb, discharge


#INVERSE
#Turb, FDOM
# cor(MC.2018[4,], -MC.2018[1,])
# cor(MC.2018[4,], MC.2018[1,])
# cor(AllData8$Turb, -AllData8$FDOMqsu)
```

Graphs of the main channel vs backwater. Each consitutent has a function to graph the mc vs bw for each year
```{r MC vs BW}

#Main channel vs backwater for each variable, for each year
AllData5<-AllData %>% filter(Year=='2015')
AllData6<-AllData %>% filter(Year=='2016')
AllData8<-AllData %>% filter(Year=='2018')

LocationN03<- function(datax, yr){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=NO3_mgL, color = Area), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=0, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Nitrate (mgL)")+
  ggtitle(paste("Nitrate in", yr,  "in the Main channel and Backwater", sep=" "))+
    scale_color_manual(values= c("#E69F00","#56B4E9" ), name= "Location", labels=c("Main Channel", "Backwater")) +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}
LocationN03(AllData5, "2015")
LocationN03(AllData6, "2016")
LocationN03(AllData8, "2018")


LocationFDOM<- function(datax, yr){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=FDOMqsu, color = Area), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=90, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "FDOM (qsu)")+
  ggtitle(paste("FDOM in", yr,  "in the Main channel and Backwater", sep=" "))+
    scale_color_manual(values= c("#E69F00","#56B4E9" ), name= "Location", labels=c("Main Channel", "Backwater")) +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}
LocationFDOM(AllData5, "2015")
LocationFDOM(AllData6, "2016")
LocationFDOM(AllData8, "2018")


LocationCHL<- function(datax, yr){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=CHLugL, color = Area), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=0, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Chlorophyll-a (ugL)")+
  ggtitle(paste("Chlorophyll-a in", yr,  "in the Main channel and Backwater", sep=" "))+
    scale_color_manual(values= c("#E69F00","#56B4E9" ), name= "Location", labels=c("Main Channel", "Backwater")) +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}
LocationCHL(AllData5, "2015")
LocationCHL(AllData6, "2016")
LocationCHL(AllData8, "2018")


LocationBGA<- function(datax, yr){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=BGAugL, color = Area), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=0, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Blue-Green Algae (ugL)")+
  ggtitle(paste("Blue-Green Algae in", yr,  "in the Main channel and Backwater", sep=" "))+
    scale_color_manual(values= c("#E69F00","#56B4E9" ), name= "Location", labels=c("Main Channel", "Backwater")) +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}
LocationBGA(AllData5, "2015")
LocationBGA(AllData6, "2016")
LocationBGA(AllData8, "2018")



LocationTurb<- function(datax, yr){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=Turb, color = Area), size=1) + 
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=0, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Turbidity (NTU)")+
  ggtitle(paste("Turbidity in", yr,  "in the Main channel and Backwater", sep=" "))+
    scale_color_manual(values= c("#E69F00","#56B4E9" ), name= "Location", labels=c("Main Channel", "Backwater")) +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}
LocationTurb(AllData5, "2015")
LocationTurb(AllData6, "2016")
LocationTurb(AllData8, "2018")


```

Plots of discharge against each variable. Each variable has a function to graph discharge vs the variable for each year and location

```{r Discharge plots}

#Discharge vs each constituent for each year/location
PairGraphsDB<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=Discharge), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(BGAugL*10000)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=10000, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Discharge (csu)",
    sec.axis = sec_axis(~./10000, name="Blue-Green Algae (ugL)")
  ) + 
  
  ggtitle(paste("Blue-Green Algae and Discharge in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsDB(AllDataMC5, '2015', 'Main Channel')
PairGraphsDB(AllDataMC6, '2016', 'Main Channel')
PairGraphsDB(AllDataMC7, '2017', 'Main Channel')
PairGraphsDB(AllDataMC8, '2018', 'Main Channel')
PairGraphsDB(AllDataSI5, '2015', 'Backwater')
PairGraphsDB(AllDataSI6, '2016', 'Backwater')
PairGraphsDB(AllDataSI8, '2018', 'Backwater')

PairGraphsDC<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=Discharge), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(CHLugL*500)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=10000, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Discharge (csu)",
    sec.axis = sec_axis(~./500, name="Chlorophyll-a (ugL)")
  ) + 
  
  ggtitle(paste("Chlorophyll-a and Discharge in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsDC(AllDataMC5, '2015', 'Main Channel')
PairGraphsDC(AllDataMC6, '2016', 'Main Channel')
PairGraphsDC(AllDataMC7, '2017', 'Main Channel')
PairGraphsDC(AllDataMC8, '2018', 'Main Channel')
PairGraphsDC(AllDataSI5, '2015', 'Backwater')
PairGraphsDC(AllDataSI6, '2016', 'Backwater')
PairGraphsDC(AllDataSI8, '2018', 'Backwater')


PairGraphsDF<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=Discharge), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(FDOMqsu*250)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=10000, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Discharge (csu)",
    sec.axis = sec_axis(~./250, name="FDOM (qsu)")
  ) + 
  
  ggtitle(paste("FDOM and Discharge in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsDF(AllDataMC5, '2015', 'Main Channel')
PairGraphsDF(AllDataMC6, '2016', 'Main Channel')
PairGraphsDF(AllDataMC7, '2017', 'Main Channel')
PairGraphsDF(AllDataMC8, '2018', 'Main Channel')
PairGraphsDF(AllDataSI5, '2015', 'Backwater')
PairGraphsDF(AllDataSI6, '2016', 'Backwater')
PairGraphsDF(AllDataSI8, '2018', 'Backwater')


PairGraphsDN<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=Discharge), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(NO3_mgL*10000)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=10000, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Discharge (csu)",
    sec.axis = sec_axis(~./10000, name="Nitrate (mgL)")
  ) + 
  
  ggtitle(paste("Nitrate and Discharge in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsDN(AllDataMC5, '2015', 'Main Channel')
PairGraphsDN(AllDataMC6, '2016', 'Main Channel')
PairGraphsDN(AllDataMC7, '2017', 'Main Channel')
PairGraphsDN(AllDataMC8, '2018', 'Main Channel')
PairGraphsDN(AllDataSI5, '2015', 'Backwater')
PairGraphsDN(AllDataSI6, '2016', 'Backwater')
PairGraphsDN(AllDataSI8, '2018', 'Backwater')


PairGraphsDT<- function(datax, yr, location){
  ggplot(data=datax) + geom_line(mapping=aes(x=num, y=Discharge), color= "#56B4E9", size=1) + 
   geom_line(mapping=aes(x=num, y=(Turb*5000)), color= "#E69F00", size=1) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=10000, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  scale_y_continuous(
    name = "Discharge (csu)",
    sec.axis = sec_axis(~./5000, name="Turbidity (NTU)")
  ) + 
  
  ggtitle(paste("Turbidity and Discharge in", yr,  "in the", location, sep=" "))+
  theme(
    axis.title.y = element_text(color = "#56B4E9", size=13),
    axis.title.y.right = element_text(color = "#E69F00", size=13)
  ) +
    labs(x="Month") +
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
}

PairGraphsDF(AllDataMC5, '2015', 'Main Channel')
PairGraphsDF(AllDataMC6, '2016', 'Main Channel')
PairGraphsDF(AllDataMC7, '2017', 'Main Channel')
PairGraphsDF(AllDataMC8, '2018', 'Main Channel')
PairGraphsDF(AllDataSI5, '2015', 'Backwater')
PairGraphsDF(AllDataSI6, '2016', 'Backwater')
PairGraphsDF(AllDataSI8, '2018', 'Backwater')


ggplot(data=AllDataMC) + geom_line(mapping=aes(x=num, y=Discharge, color= Type), size=1) + 
  #facet_wrap(~Area)+ #, labeller= labeller( Type=YearsAreas)) +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=10000, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  labs(x= "Month", y= "Discharge (csu)")+
  scale_color_manual(values= c("#999999", "#E69F00", "#56B4E9", "#009E73"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
  
  ggtitle("Discharge Levels Each Year in the Main Channel")+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

```

Boxplots showing the ranges for each varaible. Each variable has its own boxplot, with the location and years all on that chart

```{r Boxplots}
#Showing ranges of each variable

ggplot(AllData) + geom_boxplot(mapping= aes(x=Type, y= NO3_mgL))+
  labs(x= "Location and Year", y= "Nitrate (mgL)", title= "Nitrate Levels")+
  scale_x_discrete(labels=c("Main Channel \n 2015", "Main Channel \n 2016", "Main Channel \n 2017", "Main Channel \n 2018", "Backwater \n 2015", "Backwater \n 2016", "Backwater \n 2018"))

ggplot(AllData) + geom_boxplot(mapping= aes(x=Type, y= FDOMqsu))+
  labs(x= "Location and Year", y= "FDOM (qsu)", title= "FDOM Levels")+
  scale_x_discrete(labels=c("Main Channel \n 2015", "Main Channel \n 2016", "Main Channel \n 2017", "Main Channel \n 2018", "Backwater \n 2015", "Backwater \n 2016", "Backwater \n 2018"))

ggplot(AllData) + geom_boxplot(mapping= aes(x=Type, y= CHLugL))+
  labs(x= "Location and Year", y= "Chlorophyll-a (ugL)", title= "Chlorophyll-a Levels")+
  scale_x_discrete(labels=c("Main Channel \n 2015", "Main Channel \n 2016", "Main Channel \n 2017", "Main Channel \n 2018", "Backwater \n 2015", "Backwater \n 2016", "Backwater \n 2018"))

ggplot(AllData) + geom_boxplot(mapping= aes(x=Type, y= BGAugL))+
  labs(x= "Location and Year", y= "Blue-Green Algae (ugL)", title= "Blue-Green Algae Levels")+
  scale_x_discrete(labels=c("Main Channel \n 2015", "Main Channel \n 2016", "Main Channel \n 2017", "Main Channel \n 2018", "Backwater \n 2015", "Backwater \n 2016", "Backwater \n 2018"))

ggplot(AllData) + geom_boxplot(mapping= aes(x=Type, y= Turb))+
  labs(x= "Location and Year", y= "Turbidity (NTU)", title= "Turbidity Levels")+
  scale_x_discrete(labels=c("Main Channel \n 2015", "Main Channel \n 2016", "Main Channel \n 2017", "Main Channel \n 2018", "Backwater \n 2015", "Backwater \n 2016", "Backwater \n 2018"))

ggplot(AllData) + geom_boxplot(mapping= aes(x=Type, y= Turb))+
  labs(x= "Location and Year", y= "Turbidity (NTU)", title= "Turbidity Levels Zoomed In")+
  scale_x_discrete(labels=c("Main Channel \n 2015", "Main Channel \n 2016", "Main Channel \n 2017", "Main Channel \n 2018", "Backwater \n 2015", "Backwater \n 2016", "Backwater \n 2018"))+ ylim(NA, 25)

ggplot(AllData) + geom_boxplot(mapping= aes(x=Year, y= Discharge))+
  labs(x= "Year", y= "Discharge (csu)", main= "Discharge Levels")+
  scale_x_discrete(labels=c(" 2015", "2016", "2017", "2018"))
  
```

Plot the predicted fit against the actual variable for each variable for the mc 2016 data

```{r Fit}

#2016 MC fit for each variable-for Z-scored
ylbl<- c("Turbidity \n (NTU)", "Cholorphyll-a \n (ugL)", "Blue-green \n algae (ugL)", "Dissolved \n Organic \n Matter (qsu)", "Nitrate \n (mgL)")

#2018 Main Channel
## get model fits & CI's
mod_fit4 <- get_DFA_fits(mod6, alpha= .05)


## plot the fits
mod_fit2016<-as.data.frame(t(mod_fit6$ex))
colnames(mod_fit2016)<- c(spp)
mod_fit2016<- mod_fit2016 %>% mutate(Time= c(1:204))
M2016df<- as.data.frame(t(MC.2016))
M2016df<- M2016df %>% mutate(Time= c(1:204))

NO3m6<-ggplot(data= mod_fit2016) + 
  geom_line(mapping= aes(x= Time, y= NO3_mgL, color='black'), size=1.25)+
  labs(x="Month", y= "Nitrate \n (Z-scored)", title= "DFA Model Prediction of Nitrate in the Main Channel, 2016") +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-3, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  geom_line(data=M2016df, mapping=aes(x=Time, y=NO3_mgL, color='#999999'),size=1)+
  geom_point(data=M2016df, mapping=aes(x=Time, y=NO3_mgL, color="#0072B2"),size=1.5, shape=16 )+
  theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())+
  guides(color = guide_legend(reverse=F, title= " "))+
  scale_colour_identity(breaks=c('black', "#0072B2"), labels= c("Model", "Data"), guide="legend")

turbm6<-ggplot(data= mod_fit2016) + 
  geom_line(mapping= aes(x= Time, y= Turb), size=1.25)+
  labs(x="Month", y= "Turbidity \n (Z-scored)", title= "DFA Model Prediction in the Main Channel, 2016") +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-4, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  geom_line(data=M2016df, mapping=aes(x=Time, y=Turb), color='#999999',size=1.5)+
  geom_point(data=M2016df, mapping=aes(x=Time, y=Turb), color="#009E73",size=1.25, shape=16 )+
  theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

CHLm6<-ggplot(data= mod_fit2016) + 
  geom_line(mapping= aes(x= Time, y= CHLugL), size=1.25)+
  labs(x="Month", y= "Chlorophyll-a \n (Z-scored)", title= "DFA Model Prediction of Chlorophyll-a in the Main Channel, 2016") +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-3, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  geom_line(data=M2016df, mapping=aes(x=Time, y=CHLugL), color='#999999',size=1)+
  geom_point(data=M2016df, mapping=aes(x=Time, y=CHLugL), color="#0072B2",size=1.5, shape=16 )+
  theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

BGAm6<-ggplot(data= mod_fit2016) + 
  geom_line(mapping= aes(x= Time, y= BGAugL), size=1.25)+
  labs(x="Month", y= "Blue-Green Algae \n(Z-scored)", title= "DFA Model Prediction of Blue-Green Algae in the Main Channel, 2016") +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-2.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  geom_line(data=M2016df, mapping=aes(x=Time, y=BGAugL), color='#999999',size=1)+
  geom_point(data=M2016df, mapping=aes(x=Time, y=BGAugL), color="#0072B2",size=1.5, shape=16 )+
  theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())

FDOMm6<-ggplot(data= mod_fit2016) + 
  geom_line(mapping= aes(x= Time, y= FDOMqsu), size=1.25)+
  labs(x="Month", y= "FDOM \n (Z-scored)", title= "DFA Model Prediction of Fluorescent Dissolved Organic Matter") +
  geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
  annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171)+15), y=-3.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct"), size=3.5) +
  theme(panel.grid.major.x = element_blank()) +
  theme(panel.grid.minor.x = element_blank())+
  geom_line(data=M2016df, mapping=aes(x=Time, y=FDOMqsu), color='#999999',size=1)+
  geom_point(data=M2016df, mapping=aes(x=Time, y=FDOMqsu), color="#0072B2",size=1.5, shape=16 )+
   theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
  
 turbm6
 CHLm6
 BGAm6
 FDOMm6
 NO3m6
# 
# for(i in 1:5) {
#  # up <- mod_fit$up[i,]
#   mn <- mod_fit$ex[i,]
#   #lo <- mod_fit$lo[i,]
#   plot(w_ts,mn,xlab="Time",ylab=ylbl[i],xaxt="n",type="n", cex.lab=1.2,
#        ylim=c(min(lo),(max(up))))
#   points(w_ts,MC.2018[i,], pch=16, col=clr[i])
#   #lines(w_ts, up, col="darkgray")
#   lines(w_ts, mn, col="black", lwd=2)
#   #lines(w_ts, lo, col="darkgray")
# }

# AllDataMC6<-AllData %>% filter(Type=='MC2016')
# ggplot(data=AllDataMC6) + geom_line(mapping=aes(x=num, y=CHLugL), color= "#56B4E9", size=1) + 
#    geom_line(mapping=aes(x=num, y=BGAugL*10), color= "#E69F00", size=1) +
#   #facet_wrap(~Area)+ #, labeller= labeller( Type=YearsAreas)) +
#   geom_vline(xintercept=c(19, 50, 80, 111, 142, 171, 203) , col="darkgray")+
#   annotate(geom= "text", x= (c(-13,19, 50, 80, 111, 142, 171, 203)+15), y=-.5, label=c("April", "May", "June", "July", "Aug", "Sept", "Oct", "Nov"), size=3.5) +
#   theme(panel.grid.major.x = element_blank()) +
#   theme(panel.grid.minor.x = element_blank())+
#   #labs(x= "Month", y= "Nitrate (mgL)")+
#  # scale_color_manual(values= c("#E69F00", "#56B4E9"), name= "Year", labels=c("2015", "2016", "2017", "2018")) +
#   scale_y_continuous(
# 
#     name = "Chlorophyll-a (ugL)",
#     
#     # Add a second axis and specify its features
#     sec.axis = sec_axis(~./10, name="Blue-Green Algae (ugL)")
#   ) + 
#   
#   ggtitle("Chlorophyll-a and Blue-Green Algae Levels in 2016 in the Main Channel")+
#   theme(
#     axis.title.y = element_text(color = "#56B4E9", size=13),
#     axis.title.y.right = element_text(color = "#E69F00", size=13)
#   ) +
#    theme(axis.text.x= element_blank(), axis.ticks.x = element_blank())
# #"#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"
```

Dot plot of each variable against another variable. Plots include data from all years for the main channel and a trendline

```{r Relationship of Variables MC}
#Dotplot with relationships of pairs

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=BGAugL, y=CHLugL, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Chlorophyll-a (ugL)", title= "Chlorophyll-a vs Blue-Green Algae in the Main Channel")+
  geom_smooth(aes(x=BGAugL, y=CHLugL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=BGAugL, y=FDOMqsu, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="FDOM (qsu)", title= "FDOM vs Blue-Green Algae in the Main Channel")+
  geom_smooth(aes(x=BGAugL, y=FDOMqsu),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=BGAugL, y=NO3_mgL, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Nitrate (mgL)", title= "Nitrate vs Blue-Green Algae in the Main Channel")+
  geom_smooth(aes(x=BGAugL, y=NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=BGAugL, y=Turb, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Turbidity (NTU)", title= "Turbidity vs Blue-Green Algae in the Main Channel")+
  geom_smooth(aes(x=BGAugL, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA,30)

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=BGAugL, y=Discharge, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Discharge (csu)", title= "Discharge vs Blue-Green Algae in the Main Channel")+
  geom_smooth(aes(x=BGAugL, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=CHLugL, y=FDOMqsu, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="FDOM (qsu)", title= "FDOM vs Chlorophyll-a in the Main Channel")+
  geom_smooth(aes(x=CHLugL, FDOMqsu),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=CHLugL, y=NO3_mgL, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Nitrate (mgL)", title= "Nitrate vs Chlorophyll-a in the Main Channel")+
  geom_smooth(aes(x=CHLugL, NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=CHLugL, y=Turb, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Turbidity (NTU)", title= "Turbidity vs Chlorophyll-a in the Main Channel")+
  geom_smooth(aes(x=CHLugL, Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 35)

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=CHLugL, y=Discharge, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Discharge (csu)", title= "Discharge vs Chlorophyll-a in the Main Channel")+
  geom_smooth(aes(x=CHLugL, Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=FDOMqsu, y=NO3_mgL, color=Year))+
  labs(x="FDOM (qsu)", y= "Nitrate (mgL)", title= "Nitrate vs FDOM in the Main Channel")+
  geom_smooth(aes(x=FDOMqsu, y=NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=FDOMqsu, y=Turb, color=Year))+
  labs(x="FDOM (qsu)", y= "Turbidity (NTU)", title= "Turbidity vs FDOM in the Main Channel")+
  geom_smooth(aes(x=FDOMqsu, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 30)

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=FDOMqsu, y=Discharge, color=Year))+
  labs(x="FDOM (qsu)", y= "Discharge (csu)", title= "Discharge vs FDOM in the Main Channel")+
  geom_smooth(aes(x=FDOMqsu, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=NO3_mgL, y=Turb, color=Year))+
  labs(x="Nitrate (mgL)", y= "Turbidity (NTU)", title= "Turbidity vs Nitrate in the Main Channel")+
  geom_smooth(aes(x=NO3_mgL, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 25)

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=NO3_mgL, y=Discharge, color=Year))+
  labs(x="Nitrate (mgL)", y= "Discharge (csu)", title= "Discharge vs Nitrate in the Main Channel")+
  geom_smooth(aes(x=NO3_mgL, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataMC) +
  geom_point(mapping=aes(x=Turb, y=Discharge, color=Year))+
  labs(x="Turbidity (NTU)", y= "Discharge (csu)", title= "Discharge vs Turbidity in the Main Channel")+
  geom_smooth(aes(x=Turb, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  xlim(NA, 30)
```

Same thing as above but for the backwater

```{r Relationship of Variables BW}
#Dotplots of pairs of variables 

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=BGAugL, y=CHLugL, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Chlorophyll-a (ugL)", title= "Chlorophyll-a vs Blue-Green Algae in the Backwater")+
  geom_smooth(aes(x=BGAugL, y=CHLugL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=BGAugL, y=FDOMqsu, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="FDOM (qsu)", title= "FDOM vs Blue-Green Algae in the Backwater")+
  geom_smooth(aes(x=BGAugL, y=FDOMqsu),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=BGAugL, y=NO3_mgL, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Nitrate (mgL)", title= "Nitrate vs Blue-Green Algae in the Backwater")+
  geom_smooth(aes(x=BGAugL, y=NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=BGAugL, y=Turb, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Turbidity (NTU)", title= "Turbidity vs Blue-Green Algae in the Backwater")+
  geom_smooth(aes(x=BGAugL, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA,30)

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=BGAugL, y=Discharge, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Discharge (csu)", title= "Discharge vs Blue-Green Algae in the Backwater")+
  geom_smooth(aes(x=BGAugL, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=CHLugL, y=FDOMqsu, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="FDOM (qsu)", title= "FDOM vs Chlorophyll-a in the Backwater")+
  geom_smooth(aes(x=CHLugL, FDOMqsu),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=CHLugL, y=NO3_mgL, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Nitrate (mgL)", title= "Nitrate vs Chlorophyll-a in the Backwater")+
  geom_smooth(aes(x=CHLugL, NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=CHLugL, y=Turb, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Turbidity (NTU)", title= "Turbidity vs Chlorophyll-a in the Backwater")+
  geom_smooth(aes(x=CHLugL, Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 35)

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=CHLugL, y=Discharge, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Discharge (csu)", title= "Discharge vs Chlorophyll-a in the Backwater")+
  geom_smooth(aes(x=CHLugL, Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=FDOMqsu, y=NO3_mgL, color=Year))+
  labs(x="FDOM (qsu)", y= "Nitrate (mgL)", title= "Nitrate vs FDOM in the Backwater")+
  geom_smooth(aes(x=FDOMqsu, y=NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=FDOMqsu, y=Turb, color=Year))+
  labs(x="FDOM (qsu)", y= "Turbidity (NTU)", title= "Turbidity vs FDOM in the Backwater")+
  geom_smooth(aes(x=FDOMqsu, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 30)

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=FDOMqsu, y=Discharge, color=Year))+
  labs(x="FDOM (qsu)", y= "Discharge (csu)", title= "Discharge vs FDOM in the Backwater")+
  geom_smooth(aes(x=FDOMqsu, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=NO3_mgL, y=Turb, color=Year))+
  labs(x="Nitrate (mgL)", y= "Turbidity (NTU)", title= "Turbidity vs Nitrate in the Backwater")+
  geom_smooth(aes(x=NO3_mgL, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 25)

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=NO3_mgL, y=Discharge, color=Year))+
  labs(x="Nitrate (mgL)", y= "Discharge (csu)", title= "Discharge vs Nitrate in the Backwater")+
  geom_smooth(aes(x=NO3_mgL, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllDataSI) +
  geom_point(mapping=aes(x=Turb, y=Discharge, color=Year))+
  labs(x="Turbidity (NTU)", y= "Discharge (csu)", title= "Discharge vs Turbidity in the Backwater")+
  geom_smooth(aes(x=Turb, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  xlim(NA, 30)
```

The above graphs but the mc and bw are both included

```{r Relationship of Variables Both}
#Dotplots for both

ggplot(data=AllData) +
  geom_point(mapping=aes(x=BGAugL, y=CHLugL, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Chlorophyll-a (ugL)", title= "Chlorophyll-a vs Blue-Green Algae for All Locations")+
  geom_smooth(aes(x=BGAugL, y=CHLugL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=BGAugL, y=FDOMqsu, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="FDOM (qsu)", title= "FDOM vs Blue-Green Algae for All Locations")+
  geom_smooth(aes(x=BGAugL, y=FDOMqsu),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=BGAugL, y=NO3_mgL, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Nitrate (mgL)", title= "Nitrate vs Blue-Green Algae for All Locations")+
  geom_smooth(aes(x=BGAugL, y=NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=BGAugL, y=Turb, color=Year))+
  labs(x="Blue-Green Algae (ugL)", y="Turbidity (NTU)", title= "Turbidity vs Blue-Green Algae for All Locations")+
  geom_smooth(aes(x=BGAugL, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA,30)

ggplot(data=AllData) +
  geom_point(mapping=aes(x=Discharge, y=BGAugL, color=Year))+
  labs(x= "Discharge (csu)", y= "Blue-Green Algae (ugL)", title= "Discharge vs Blue-Green Algae for All Locations")+
  geom_smooth(aes(x=Discharge, y=BGAugL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#0072B2", "#56B4E9", "#009E73", "#D55E00"))+
  annotate(geom="label", x=100000, y=4, label="r = -0.41")

ggplot(data=AllData) +
  geom_point(mapping=aes(x=CHLugL, y=FDOMqsu, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="FDOM (qsu)", title= "FDOM vs Chlorophyll-a for All Locations")+
  geom_smooth(aes(x=CHLugL, FDOMqsu),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=CHLugL, y=NO3_mgL, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Nitrate (mgL)", title= "Nitrate vs Chlorophyll-a for All Locations")+
  geom_smooth(aes(x=CHLugL, NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=CHLugL, y=Turb, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Turbidity (NTU)", title= "Turbidity vs Chlorophyll-a for All Locations")+
  geom_smooth(aes(x=CHLugL, Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 35)

ggplot(data=AllData) +
  geom_point(mapping=aes(x=CHLugL, y=Discharge, color=Year))+
  labs(x="Chlorophyll-a (ugL)", y="Discharge (csu)", title= "Discharge vs Chlorophyll-a for All Locations")+
  geom_smooth(aes(x=CHLugL, Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=FDOMqsu, y=NO3_mgL, color=Year))+
  labs(x="FDOM (qsu)", y= "Nitrate (mgL)", title= "Nitrate vs FDOM for All Locations")+
  geom_smooth(aes(x=FDOMqsu, y=NO3_mgL),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=FDOMqsu, y=Turb, color=Year))+
  labs(x="FDOM (qsu)", y= "Turbidity (NTU)", title= "Turbidity vs FDOM for All Locations")+
  geom_smooth(aes(x=FDOMqsu, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 30)

ggplot(data=AllData) +
  geom_point(mapping=aes(x=FDOMqsu, y=Discharge, color=Year))+
  labs(x="FDOM (qsu)", y= "Discharge (csu)", title= "Discharge vs FDOM for All Locations")+
  geom_smooth(aes(x=FDOMqsu, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=NO3_mgL, y=Turb, color=Year))+
  labs(x="Nitrate (mgL)", y= "Turbidity (NTU)", title= "Turbidity vs Nitrate for All Locations")+
  geom_smooth(aes(x=NO3_mgL, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))+
  ylim(NA, 25)

ggplot(data=AllData) +
  geom_point(mapping=aes(x=NO3_mgL, y=Discharge, color=Year))+
  labs(x="Nitrate (mgL)", y= "Discharge (csu)", title= "Discharge vs Nitrate for All Locations")+
  geom_smooth(aes(x=NO3_mgL, y=Discharge),method='lm', se=FALSE)+
  scale_color_manual(values= c("#E69F00", "#56B4E9", "#009E73", "#F0E442"))

ggplot(data=AllData) +
  geom_point(mapping=aes(x=Discharge, y=Turb, color=Year))+
  labs(x= "Discharge (csu)", y= "Turbidity (NTU)", title= "Discharge vs Turbidity")+
  geom_smooth(aes(x=Discharge, y=Turb),method='lm', se=FALSE)+
  scale_color_manual(values= c("#0072B2", "#56B4E9", "#009E73", "#D55E00"))+
  ylim(NA, 25) +
  annotate(geom="label", x=80000, y=22, label= "r = 0.12")

#"#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00"
```

Correlations between pairs for all data

```{r Correlations between pairs}
cor(AllDataMC$BGAugL, AllDataMC$CHLugL)
cor(AllDataZMC$BGAugL, AllDataZMC$CHLugL)
cor(AllDataMC$BGAugL, AllDataMC$FDOMqsu)
cor(AllDataMC$BGAugL, AllDataMC$NO3_mgL)
cor(AllDataMC$BGAugL, AllDataMC$Turb)
cor(AllDataMC$BGAugL, AllDataMC$Discharge)
cor(AllDataMC$CHLugL, AllDataMC$FDOMqsu)
cor(AllDataMC$CHLugL, AllDataMC$NO3_mgL)
cor(AllDataMC$CHLugL, AllDataMC$Turb)
cor(AllDataMC$CHLugL, AllDataMC$Discharge)
cor(AllDataMC$FDOMqsu, AllDataMC$NO3_mgL)
cor(AllDataMC$FDOMqsu, AllDataMC$Turb)
cor(AllDataMC$FDOMqsu, AllDataMC$Discharge)
cor(AllDataMC$NO3_mgL, AllDataMC$Turb)
cor(AllDataMC$NO3_mgL, AllDataMC$Discharge)
cor(AllDataMC$Turb, AllDataMC$Discharge)

AllDataZMC=as.data.frame(rbind(t(MC.2018), t(MC.2017), t(MC.2016), t(MC.2015c)))
t.test(AllDataZMC$BGAugL, AllDataZMC$CHLugL)
t.test(AllDataZMC$BGAugL, AllDataZMC$BGAugL)
t.test(AllDataZMC$BGAugL, AllDataZMC$FDOMqsu, paired=TRUE)
t.test(AllDataZMC$BGAugL, AllDataZMC$NO3_mgL)
t.test(AllDataMC$BGAugL, AllDataMC$Turb)

```

